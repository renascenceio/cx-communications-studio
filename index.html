<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Communications Navigation Toolkit ‚Äî Renascence</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ‚îÄ‚îÄ DARK THEME (default) ‚îÄ‚îÄ */
:root {
  --bg: #0b0d1c;
  --bg2: #10132a;
  --panel: #151830;
  --panel2: #1c2040;
  --border: rgba(255,255,255,0.07);
  --border2: rgba(255,255,255,0.14);
  --accent: #7b7ff5;
  --accent2: #a5a8f8;
  --text: #e4e6f5;
  --text2: #8b8fbc;
  --text3: #4a4e7a;
  --gold: #f5c842;
  --shadow: rgba(0,0,0,0.4);
  --header-bg: rgba(11,13,28,0.95);
  --tooltip-bg: #1c2040;
  --c-NO: #5b9ef7; --c-CO: #3ecf7a; --c-RE: #f5a623;
  --c-LN: #f55a5a; --c-GU: #22d3ee; --c-IN: #b07ef5;
  --c-FU: #f97316; --c-UP: #e879a0; --c-VOC: #14b8a6;
  --s-booking: #5b9ef7; --s-waiting: #9b7ef5;
  --s-handover: #22d3ee; --s-living: #3ecf7a;
  --s-marketing: #f5a623;
  --radial-ring: rgba(255,255,255,0.032);
  --radial-bg: #0b0d1c;
}

/* ‚îÄ‚îÄ LIGHT THEME ‚îÄ‚îÄ */
html.light {
  --bg: #f5f6fa;
  --bg2: #eceef6;
  --panel: #ffffff;
  --panel2: #f0f1f9;
  --border: rgba(100,108,180,0.12);
  --border2: rgba(100,108,180,0.22);
  --accent: #5558e3;
  --accent2: #6366f1;
  --text: #1a1c3a;
  --text2: #4a4e7a;
  --text3: #9096c0;
  --gold: #c8921a;
  --shadow: rgba(80,90,160,0.12);
  --header-bg: rgba(245,246,250,0.96);
  --tooltip-bg: #ffffff;
  --c-NO: #2b7ee0; --c-CO: #1a9e55; --c-RE: #d4870a;
  --c-LN: #d93a3a; --c-GU: #0891b2; --c-IN: #7c3aed;
  --c-FU: #c2410c; --c-UP: #be185d; --c-VOC: #0d8a7a;
  --s-booking: #2b7ee0; --s-waiting: #7c3aed;
  --s-handover: #0891b2; --s-living: #1a9e55;
  --s-marketing: #d4870a;
  --radial-ring: rgba(80,90,160,0.08);
  --radial-bg: #f5f6fa;
  --modal-overlay: rgba(180,185,220,0.7);
}
* { margin:0; padding:0; box-sizing:border-box; }
html,body { height:100%; }
body { font-family:'Sora',sans-serif; background:var(--bg); color:var(--text); overflow-x:hidden; }

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header {
  position:fixed; top:0; left:0; right:0; z-index:200;
  height:56px; display:flex; align-items:center; justify-content:space-between;
  padding:0 28px;
  background:var(--header-bg); backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
  transition: background .3s, border-color .3s;
}
.logo { font-family:'Space Mono',monospace; font-size:11px; letter-spacing:.15em; color:var(--text2); text-transform:uppercase; }
.logo em { color:var(--accent); font-style:normal; }
.hdr-title { font-size:13px; font-weight:500; color:var(--text); letter-spacing:.02em; }

/* Theme toggle */
.theme-toggle {
  width:38px; height:22px; border-radius:11px; border:1.5px solid var(--border2);
  background:var(--panel2); cursor:pointer; position:relative;
  transition:all .25s; flex-shrink:0; padding:0;
}
.theme-toggle::after {
  content:''; position:absolute; top:2px; left:2px;
  width:14px; height:14px; border-radius:50%;
  background:var(--accent); transition:all .25s;
}
html.light .theme-toggle::after { transform:translateX(16px); background:var(--accent); }
.theme-toggle-wrap {
  display:flex; align-items:center; gap:8px; margin-right:12px;
}
.theme-lbl { font-size:9px; font-weight:600; letter-spacing:.12em; text-transform:uppercase; color:var(--text3); }

.hdr-right { display:flex; align-items:center; gap:12px; }
.view-toggle { display:flex; gap:3px; background:var(--panel2); border:1px solid var(--border); border-radius:7px; padding:3px; }
.vt-btn {
  padding:5px 15px; border-radius:5px; border:none; background:transparent;
  font-family:'Sora',sans-serif; font-size:11px; font-weight:500; color:var(--text2);
  cursor:pointer; letter-spacing:.04em; transition:all .2s;
}
.vt-btn.active { background:var(--accent); color:#fff; box-shadow:0 2px 10px rgba(123,127,245,.4); }

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.app { padding-top:56px; height:100vh; display:flex; flex-direction:column; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TOOLKIT VIEW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#tv { display:flex; flex:1; overflow:hidden; }

/* Sidebar */
.sb {
  width:248px; flex-shrink:0; background:var(--panel);
  border-right:1px solid var(--border); overflow-y:auto;
  display:flex; flex-direction:column; gap:0;
}
.sb-sec { padding:18px 16px; border-bottom:1px solid var(--border); }
.sb-lbl { font-size:9px; font-weight:600; letter-spacing:.18em; text-transform:uppercase; color:var(--text3); margin-bottom:10px; }
.search {
  width:100%; padding:8px 11px; background:var(--bg2); border:1px solid var(--border);
  border-radius:6px; color:var(--text); font-family:'Sora',sans-serif; font-size:12px; outline:none;
  transition:border-color .2s;
}
.search:focus { border-color:var(--accent); }
.search::placeholder { color:var(--text3); }

/* Stage buttons */
.stage-btn {
  display:flex; align-items:center; gap:9px; width:100%;
  padding:8px 10px; border-radius:6px; border:none; background:transparent;
  color:var(--text2); font-family:'Sora',sans-serif; font-size:12px; font-weight:400;
  cursor:pointer; transition:all .18s; text-align:left;
}
.stage-btn:hover { background:var(--panel2); color:var(--text); }
.stage-btn.on { background:rgba(123,127,245,.12); color:var(--accent2); font-weight:500; }
.s-dot { width:7px; height:7px; border-radius:50%; flex-shrink:0; }
.s-cnt { margin-left:auto; font-family:'Space Mono',monospace; font-size:9px; color:var(--text3); background:var(--bg); padding:2px 5px; border-radius:8px; }

/* Filter chips */
.chips { display:flex; flex-wrap:wrap; gap:4px; }
.chip {
  padding:4px 9px; border-radius:20px; border:1px solid var(--border);
  background:transparent; font-family:'Sora',sans-serif; font-size:10px; font-weight:500;
  color:var(--text2); cursor:pointer; transition:all .18s;
}
.chip:hover { border-color:var(--border2); color:var(--text); }
.chip.on { border-color:var(--accent); background:rgba(123,127,245,.15); color:var(--accent2); }

/* Type chips with color dot */
.tchip {
  display:inline-flex; align-items:center; gap:5px;
  padding:4px 9px; border-radius:20px; border:1px solid var(--border);
  background:transparent; font-family:'Space Mono',monospace; font-size:10px;
  color:var(--text2); cursor:pointer; transition:all .18s;
}
.tchip:hover { border-color:var(--border2); color:var(--text); }
.tchip.on { border-color:rgba(255,255,255,.25); background:rgba(255,255,255,.05); color:var(--text); }
.td { width:6px; height:6px; border-radius:50%; }

/* Channel chips */
.cchip {
  display:inline-flex; align-items:center; gap:5px;
  padding:4px 9px; border-radius:20px; border:1px solid var(--border);
  background:transparent; font-family:'Sora',sans-serif; font-size:10px; font-weight:500;
  color:var(--text2); cursor:pointer; transition:all .18s;
}
.cchip:hover { border-color:var(--border2); color:var(--text); }
.cchip.on { background:rgba(123,127,245,.15); border-color:var(--accent); color:var(--accent2); }
.cicon { font-size:11px; }

/* Main area */
.main { flex:1; overflow-y:auto; padding:24px 28px; }
.tb { display:flex; align-items:flex-end; justify-content:space-between; margin-bottom:20px; }
.tb-left h2 { font-size:22px; font-weight:600; color:var(--text); margin-bottom:3px; }
.tb-left p { font-size:11px; color:var(--text3); }
.tb-cnt { font-family:'Space Mono',monospace; font-size:10px; color:var(--text3); background:var(--panel); border:1px solid var(--border); padding:5px 12px; border-radius:20px; }

/* Cards */
.grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(330px,1fr)); gap:14px; }
.card {
  background:var(--panel); border:1px solid var(--border); border-radius:10px;
  padding:16px; transition:all .22s; position:relative; overflow:hidden;
}
.card::after {
  content:''; position:absolute; top:0; left:0; right:0; height:2px;
  opacity:0; transition:opacity .22s;
}
.card:hover { border-color:var(--border2); background:var(--panel2); transform:translateY(-1px); }
.card:hover::after { opacity:1; }

.card-top { display:flex; align-items:flex-start; gap:9px; margin-bottom:10px; }
.tbadge {
  font-family:'Space Mono',monospace; font-size:9px; font-weight:700; letter-spacing:.08em;
  padding:3px 7px; border-radius:4px; flex-shrink:0; margin-top:1px;
}
.cdesc { font-size:12.5px; line-height:1.55; color:var(--text); font-weight:400; }
.meta-row { display:flex; flex-wrap:wrap; gap:5px; margin-bottom:8px; }
.mpill {
  font-size:10px; padding:2px 7px; border-radius:12px; border:1px solid var(--border);
  color:var(--text2); white-space:nowrap;
}
.mpill.ch { background:rgba(123,127,245,.08); }
.mpill.dp { background:rgba(245,200,66,.07); border-color:rgba(245,200,66,.18); color:#c9a830; }
.mpill.tm { background:rgba(62,207,122,.06); border-color:rgba(62,207,122,.18); color:#4db87a; }
.trigger-line { font-size:10px; color:var(--text3); font-family:'Space Mono',monospace; margin-bottom:12px; }

/* Card action buttons */
.card-actions { display:flex; gap:8px; }
.ca-btn {
  flex:1; padding:8px 10px; border-radius:7px; border:1px solid var(--border);
  background:transparent; font-family:'Sora',sans-serif; font-size:11px; font-weight:500;
  color:var(--text2); cursor:pointer; transition:all .2s;
  display:flex; align-items:center; justify-content:center; gap:6px; line-height:1.3; text-align:center;
}
.ca-btn:hover { border-color:var(--border2); color:var(--text); background:var(--panel2); }
.ca-btn.sfmc { border-color:rgba(62,207,122,.25); color:#4db87a; }
.ca-btn.sfmc:hover { background:rgba(62,207,122,.08); border-color:rgba(62,207,122,.45); }
.ca-btn.content { border-color:rgba(123,127,245,.3); color:var(--accent2); }
.ca-btn.content:hover { background:rgba(123,127,245,.1); border-color:rgba(123,127,245,.55); }

/* Empty */
.empty { grid-column:1/-1; text-align:center; padding:60px 20px; color:var(--text3); font-size:13px; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RADIAL VIEW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#rv {
  display:none; flex:1; overflow:hidden;
  flex-direction:row; align-items:stretch;
}
.radial-panel {
  width:380px; flex-shrink:0; padding:36px 28px;
  border-right:1px solid var(--border); overflow-y:auto;
  display:flex; flex-direction:column; gap:24px;
}
.rp-title { font-size:26px; font-weight:600; line-height:1.2; }
.rp-sub { font-size:12px; color:var(--text2); line-height:1.65; margin-top:8px; }
.rp-divider { height:1px; background:var(--border); }
.rp-lbl { font-size:9px; font-weight:600; letter-spacing:.16em; text-transform:uppercase; color:var(--text3); margin-bottom:12px; }
.legend-item { display:flex; align-items:center; gap:10px; font-size:12px; color:var(--text2); padding:5px 0; }
.ld { width:10px; height:10px; border-radius:50%; flex-shrink:0; }
.lcount { margin-left:auto; font-family:'Space Mono',monospace; font-size:10px; color:var(--text3); }
.abbrev-grid { display:grid; grid-template-columns:1fr 1fr; gap:6px 12px; }
.ab { font-size:11px; color:var(--text2); }
.ab strong { font-family:'Space Mono',monospace; font-size:10px; color:var(--accent2); }
.howto-box { background:var(--panel2); border:1px solid var(--border); border-radius:8px; padding:14px; }
.howto-row { display:flex; align-items:center; gap:8px; font-size:11px; color:var(--text2); margin-bottom:6px; }
.howto-row:last-child { margin-bottom:0; }
.howto-key { font-family:'Space Mono',monospace; font-size:9px; background:var(--panel); border:1px solid var(--border); padding:2px 6px; border-radius:4px; color:var(--accent2); white-space:nowrap; }

.radial-wrap { flex:1; position:relative; overflow:hidden; }
#rsvg { width:100%; height:100%; position:absolute; inset:0; cursor:grab; }
#rsvg.dragging { cursor:grabbing; }
.zoom-controls {
  position:absolute; bottom:20px; right:20px; display:flex; flex-direction:column; gap:4px; z-index:10;
}
.zc-btn {
  width:32px; height:32px; border-radius:7px; border:1px solid var(--border2);
  background:var(--panel2); color:var(--text2); font-size:16px; cursor:pointer;
  display:flex; align-items:center; justify-content:center; transition:all .18s;
  font-family:'Space Mono',monospace; line-height:1;
}
.zc-btn:hover { background:var(--panel); color:var(--text); border-color:var(--accent); }
.zoom-level {
  text-align:center; font-family:'Space Mono',monospace; font-size:9px;
  color:var(--text3); padding:3px 0;
}

/* ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ */
.modal-bg {
  position:fixed; inset:0; background:var(--modal-overlay,rgba(5,7,20,.8)); backdrop-filter:blur(8px);
  z-index:500; display:flex; align-items:center; justify-content:center;
  opacity:0; pointer-events:none; transition:opacity .22s;
}
.modal-bg.open { opacity:1; pointer-events:all; }
.modal {
  background:var(--panel); border:1px solid var(--border2); border-radius:14px;
  width:720px; max-width:95vw; max-height:88vh; display:flex; flex-direction:column;
  transform:translateY(12px); transition:transform .22s;
}
.modal-bg.open .modal { transform:translateY(0); }
.modal-hdr {
  display:flex; align-items:flex-start; justify-content:space-between;
  padding:22px 26px 18px; border-bottom:1px solid var(--border);
}
.modal-hdr h3 { font-size:16px; font-weight:600; }
.modal-hdr p { font-size:11px; color:var(--text2); margin-top:4px; max-width:500px; line-height:1.5; }
.modal-close {
  width:30px; height:30px; border-radius:50%; border:1px solid var(--border);
  background:transparent; color:var(--text2); font-size:16px; cursor:pointer;
  display:flex; align-items:center; justify-content:center; flex-shrink:0; margin-left:12px;
  transition:all .18s;
}
.modal-close:hover { background:var(--panel2); color:var(--text); }
.modal-body { padding:22px 26px; overflow-y:auto; flex:1; }

/* Process Map Modal */
.pm-overview { font-size:12.5px; color:var(--text2); line-height:1.7; padding:16px; background:var(--bg2); border-radius:8px; margin-bottom:20px; border-left:3px solid var(--accent); }
.pm-origin { font-size:11px; color:var(--text3); margin-bottom:20px; padding:10px 14px; background:var(--panel2); border-radius:6px; }
.pm-origin strong { color:var(--text2); }
.pm-steps { display:flex; flex-direction:column; gap:0; }
.pm-step { display:grid; grid-template-columns:44px 1fr; gap:0; position:relative; }
.pm-step:not(:last-child)::after {
  content:''; position:absolute; left:21px; top:52px; bottom:0; width:1.5px;
  background:linear-gradient(to bottom, var(--step-color,var(--accent)), transparent);
  opacity:0.3; z-index:0;
}
.pm-step-left { display:flex; flex-direction:column; align-items:center; padding-top:14px; }
.pm-step-icon {
  width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center;
  font-size:13px; flex-shrink:0; z-index:1; border:1.5px solid;
}
.pm-phase-lbl { font-size:7px; font-weight:700; letter-spacing:.1em; text-transform:uppercase; margin-top:6px; writing-mode:vertical-rl; transform:rotate(180deg); opacity:0.5; }
.pm-step-body { padding:14px 0 22px 14px; }
.pm-step-title { font-size:13px; font-weight:600; margin-bottom:6px; }
.pm-step-desc { font-size:12px; color:var(--text2); line-height:1.6; margin-bottom:12px; }
.pm-meta-row { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:6px; align-items:flex-start; }
.pm-meta-label { font-size:9px; font-weight:700; letter-spacing:.12em; text-transform:uppercase; color:var(--text3); min-width:70px; padding-top:1px; flex-shrink:0; }
.pm-tools { display:flex; flex-wrap:wrap; gap:4px; }
.pm-tool { font-size:10px; padding:2px 8px; border-radius:4px; background:rgba(123,127,245,.1); border:1px solid rgba(123,127,245,.2); color:var(--accent2); font-family:'Space Mono',monospace; }
.pm-sla { font-size:11px; color:#3ecf7a; font-weight:500; }
.pm-dep { font-size:11px; color:var(--text3); }
.pm-owner-tag { font-size:10px; padding:2px 8px; border-radius:4px; background:rgba(245,200,66,.08); border:1px solid rgba(245,200,66,.2); color:#c9a830; }
.pm-slas-block { background:var(--bg2); border:1px solid var(--border); border-radius:8px; padding:16px; margin-top:20px; }
.pm-slas-title { font-size:9px; font-weight:700; letter-spacing:.14em; text-transform:uppercase; color:var(--text3); margin-bottom:12px; }
.pm-sla-row { display:flex; justify-content:space-between; align-items:center; padding:7px 0; border-bottom:1px solid var(--border); }
.pm-sla-row:last-child { border-bottom:none; }
.pm-sla-row span:first-child { font-size:11px; color:var(--text2); }
.pm-sla-row span:last-child { font-family:'Space Mono',monospace; font-size:10px; color:#3ecf7a; }
.pm-escalation { margin-top:14px; padding:12px 14px; background:rgba(245,90,90,.06); border:1px solid rgba(245,90,90,.2); border-radius:7px; }
.pm-esc-lbl { font-size:9px; font-weight:700; letter-spacing:.12em; text-transform:uppercase; color:#f55a5a; margin-bottom:5px; }
.pm-esc-text { font-size:11px; color:var(--text2); line-height:1.55; }

/* Content Modal */
.lang-tabs { display:flex; gap:0; border:1px solid var(--border); border-radius:8px; overflow:hidden; margin-bottom:20px; }
.lang-tab {
  flex:1; padding:10px; text-align:center; border:none; background:transparent;
  font-family:'Sora',sans-serif; font-size:12px; font-weight:500; color:var(--text2);
  cursor:pointer; transition:all .18s; border-right:1px solid var(--border);
}
.lang-tab:last-child { border-right:none; }
.lang-tab.on { background:var(--accent); color:#fff; }
.content-block { display:none; }
.content-block.show { display:block; }
.content-section { margin-bottom:20px; }
.cs-lbl { font-size:9px; font-weight:600; letter-spacing:.16em; text-transform:uppercase; color:var(--text3); margin-bottom:8px; }
.cs-field {
  width:100%; padding:12px 14px; background:var(--bg2); border:1px solid var(--border);
  border-radius:7px; color:var(--text); font-family:'Sora',sans-serif; font-size:13px;
  line-height:1.6; resize:vertical; outline:none; transition:border-color .2s; min-height:80px;
}
.cs-field:focus { border-color:var(--accent); }
.cs-field::placeholder { color:var(--text3); font-style:italic; }
.ar-field { direction:rtl; text-align:right; font-size:14px; }
.goal-pill { display:inline-block; font-size:11px; font-weight:600; letter-spacing:.06em; padding:5px 12px; border-radius:5px; margin-bottom:16px; }
.channel-row { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:20px; }
.ch-used { padding:5px 12px; border-radius:6px; font-size:11px; font-weight:600; }

/* Tooltip */
.tt {
  position:fixed; pointer-events:none; opacity:0; transition:opacity .12s;
  background:var(--panel2); border:1px solid var(--border2); border-radius:8px;
  padding:11px 15px; max-width:260px; z-index:300; font-size:12px;
  box-shadow:0 8px 30px var(--shadow); line-height:1.5;
}
.tt.show { opacity:1; }
.tt-type { font-family:'Space Mono',monospace; font-size:9px; margin-bottom:5px; }
.tt-meta { font-size:10px; color:var(--text3); margin-top:5px; }

/* Watermark */
.wm { position:fixed; bottom:14px; right:20px; font-family:'Space Mono',monospace; font-size:8px; letter-spacing:.14em; color:var(--text3); text-transform:uppercase; opacity:.4; pointer-events:none; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LIST VIEW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#lv { display:none; flex:1; overflow-y:auto; }
.lv-inner { max-width:900px; margin:0 auto; padding:36px 32px 60px; }
.lv-stage-block { margin-bottom:48px; }
.lv-stage-hdr {
  display:flex; align-items:center; gap:14px;
  padding:14px 20px; border-radius:10px; margin-bottom:2px;
  position:sticky; top:0; z-index:10; backdrop-filter:blur(12px);
}
.lv-stage-name { font-size:15px; font-weight:700; letter-spacing:.02em; }
.lv-stage-sub { font-size:11px; opacity:.7; margin-top:2px; }
.lv-stage-cnt {
  margin-left:auto; font-family:'Space Mono',monospace; font-size:11px;
  padding:4px 10px; border-radius:12px; font-weight:700;
}

/* List rows */
.lv-row {
  display:grid;
  grid-template-columns: 42px 44px 1fr 90px 90px 100px;
  gap:0;
  align-items:stretch;
  border-bottom:1px solid var(--border);
  transition:background .15s;
  cursor:pointer;
  min-height:44px;
}
.lv-row:hover { background:var(--panel); }
.lv-row:last-child { border-bottom:none; }

.lv-col {
  padding:11px 10px;
  display:flex; align-items:center;
  font-size:12px; color:var(--text);
}
.lv-col.num {
  font-family:'Space Mono',monospace; font-size:10px; color:var(--text3);
  justify-content:center; border-right:1px solid var(--border);
}
.lv-col.type { justify-content:center; border-right:1px solid var(--border); }
.lv-col.desc { border-right:1px solid var(--border); line-height:1.45; }
.lv-col.dept { font-size:11px; color:var(--text2); border-right:1px solid var(--border); }
.lv-col.timing { font-size:10px; color:var(--text2); border-right:1px solid var(--border); }
.lv-col.chs { gap:3px; flex-wrap:wrap; }

.lv-type-badge {
  font-family:'Space Mono',monospace; font-size:9px; font-weight:700;
  padding:3px 6px; border-radius:3px; white-space:nowrap;
}
.lv-ch-dot {
  width:6px; height:6px; border-radius:50%;
  background:var(--text3);
}

/* Table header */
.lv-thead {
  display:grid;
  grid-template-columns: 42px 44px 1fr 90px 90px 100px;
  border-bottom:2px solid var(--border2);
  margin-bottom:0;
  position:sticky; top:52px; z-index:9;
  background:var(--bg);
}
.lv-th {
  padding:8px 10px; font-size:9px; font-weight:600;
  letter-spacing:.14em; text-transform:uppercase; color:var(--text3);
}
.lv-th.center { text-align:center; }

/* ‚îÄ‚îÄ TRANSITIONS (theme switch) ‚îÄ‚îÄ */
body, header, .sb, .main, .card, .chip, .tchip, .cchip, .stage-btn,
.modal, .modal-body, .sfmc-step, .pm-step-body, .lv-row, .lv-stage-hdr,
.tb-cnt, .search, .cs-field, .howto-box, .pm-slas-block, .pm-escalation,
.radial-panel, #lv, #lv * { transition: background .25s, color .25s, border-color .25s; }

/* ‚îÄ‚îÄ LIGHT MODE OVERRIDES ‚îÄ‚îÄ */
html.light body { background:var(--bg); }
html.light .sb { background:var(--panel); border-right-color:var(--border); }
html.light .main { background:var(--bg); }
html.light .card { background:var(--panel); border-color:var(--border); }
html.light .card:hover { background:var(--panel2); }
html.light .search { background:var(--bg2); color:var(--text); border-color:var(--border); }
html.light .search::placeholder { color:var(--text3); }
html.light .modal { background:var(--panel); border-color:var(--border2); }
html.light .modal-body { background:var(--panel); }
html.light .cs-field { background:var(--bg2); color:var(--text); border-color:var(--border); }
html.light .howto-box { background:var(--panel2); border-color:var(--border); }
html.light .pm-slas-block { background:var(--bg2); border-color:var(--border); }
html.light .pm-escalation { background:rgba(217,58,58,.05); border-color:rgba(217,58,58,.2); }
html.light .pm-tool { background:rgba(85,88,227,.08); border-color:rgba(85,88,227,.18); color:var(--accent2); }
html.light .pm-overview { background:var(--bg2); border-left-color:var(--accent); }
html.light .pm-origin { background:var(--panel2); border-color:var(--border); }
html.light .lv-row:hover { background:var(--panel2); }
html.light .lv-thead { background:var(--bg); }
html.light .radial-panel { background:var(--panel); border-right-color:var(--border); }
html.light .radial-wrap { background:var(--bg); }
html.light .tt { background:var(--panel); border-color:var(--border2); box-shadow:0 8px 30px var(--shadow); }
html.light .wm { color:var(--text3); }
html.light .zc-btn { background:var(--panel); border-color:var(--border2); color:var(--text2); }
html.light .zc-btn:hover { background:var(--panel2); border-color:var(--accent); color:var(--accent); }
html.light .vt-btn.active { box-shadow:0 2px 10px rgba(85,88,227,.3); }
html.light .sfmc-step { border-bottom-color:var(--border); }
html.light header { box-shadow:0 1px 0 var(--border); }

/* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
::-webkit-scrollbar { width:3px; height:3px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--border2); border-radius:2px; }
html.light ::-webkit-scrollbar-thumb { background:rgba(100,108,180,0.25); }
</style>
</head>
<body>

<header>
  <div class="logo"><em>Renascence</em> ¬∑ CX Studio</div>
  <div class="hdr-title">Communications Navigation Toolkit</div>
  <div class="hdr-right">
    <div class="theme-toggle-wrap">
      <span class="theme-lbl" id="themeLbl">Dark</span>
      <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle light/dark mode" aria-label="Toggle theme"></button>
    </div>
    <div class="view-toggle">
      <button class="vt-btn active" id="btn-tv" onclick="setView('tv')">‚äû &nbsp;Toolkit</button>
      <button class="vt-btn" id="btn-rv" onclick="setView('rv')">‚óâ &nbsp;Radial Map</button>
      <button class="vt-btn" id="btn-lv" onclick="setView('lv')">‚â° &nbsp;List</button>
    </div>
  </div>
</header>

<div class="app">

<!-- ‚ïê‚ïê‚ïê TOOLKIT ‚ïê‚ïê‚ïê -->
<div id="tv">
  <aside class="sb">
    <div class="sb-sec">
      <div class="sb-lbl">Search</div>
      <input class="search" id="srch" placeholder="Search communications‚Ä¶" oninput="render()">
    </div>
    <div class="sb-sec">
      <div class="sb-lbl">Journey Stage</div>
      <div style="display:flex;flex-direction:column;gap:2px;" id="sNav"></div>
    </div>
    <div class="sb-sec">
      <div class="sb-lbl">Channel</div>
      <div class="chips" id="chFilters"></div>
    </div>
    <div class="sb-sec">
      <div class="sb-lbl">Department</div>
      <div class="chips" id="dpFilters"></div>
    </div>
    <div class="sb-sec" style="border-bottom:none">
      <div class="sb-lbl">Comm Type</div>
      <div class="chips" id="tpFilters"></div>
    </div>
  </aside>

  <main class="main">
    <div class="tb">
      <div class="tb-left">
        <h2 id="stTitle">All Stages</h2>
        <p id="stSub">Complete communications framework across the customer lifecycle</p>
      </div>
      <div class="tb-cnt" id="cnt">‚Äî items</div>
    </div>
    <div class="grid" id="grid"></div>
  </main>
</div>

<!-- ‚ïê‚ïê‚ïê RADIAL ‚ïê‚ïê‚ïê -->
<div id="rv">
  <div class="radial-panel">
    <div>
      <div class="rp-title">Communications Map</div>
      <div class="rp-sub">Every communication across the customer lifecycle ‚Äî who sends it, through which channel, and when it fires. Hover any spoke to explore.</div>
    </div>
    <div class="rp-divider"></div>
    <div>
      <div class="rp-lbl">How to Read</div>
      <div class="howto-box">
        <div class="howto-row"><span class="howto-key">WHO</span> Department responsible for sending</div>
        <div class="howto-row"><span class="howto-key">WHAT</span> Description of the communication</div>
        <div class="howto-row"><span class="howto-key">HOW</span> Channel (Email, SMS, WhatsApp‚Ä¶)</div>
        <div class="howto-row"><span class="howto-key">WHEN</span> Trigger timing / frequency</div>
        <div class="howto-row"><span class="howto-key">WHY</span> Communication type &amp; goal</div>
      </div>
    </div>
    <div>
      <div class="rp-lbl">Journey Stages</div>
      <div id="rLegend"></div>
    </div>
    <div>
      <div class="rp-lbl">Abbreviations</div>
      <div class="abbrev-grid" id="rAbbrev"></div>
    </div>
  </div>
  <div class="radial-wrap" id="radialWrap">
    <svg id="rsvg" viewBox="0 0 680 680"><g id="rsvgG"></g></svg>
    <div class="zoom-controls">
      <button class="zc-btn" onclick="zoomBy(1.25)" title="Zoom in">+</button>
      <div class="zoom-level" id="zoomLbl">100%</div>
      <button class="zc-btn" onclick="zoomBy(0.8)" title="Zoom out">‚àí</button>
      <button class="zc-btn" onclick="zoomReset()" title="Reset" style="font-size:11px">‚ü≥</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê LIST VIEW ‚ïê‚ïê‚ïê -->
<div id="lv">
  <div class="lv-inner" id="lvInner"></div>
</div>

</div><!-- /app -->

<!-- ‚ïê‚ïê‚ïê PROCESS MAP MODAL ‚ïê‚ïê‚ïê -->
<div class="modal-bg" id="sfmcModal">
  <div class="modal" style="width:780px;max-width:96vw;">
    <div class="modal-hdr">
      <div>
        <h3 id="sfmcTitle">Process Map</h3>
        <p id="sfmcSub">Real-life process ‚Äî origin, flow, tools, dependencies and SLAs</p>
      </div>
      <button class="modal-close" onclick="closeModal('sfmcModal')">√ó</button>
    </div>
    <div class="modal-body" id="sfmcBody"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê CONTENT MODAL ‚ïê‚ïê‚ïê -->
<div class="modal-bg" id="contentModal">
  <div class="modal" style="width:720px;">
    <div class="modal-hdr">
      <div>
        <h3 id="cTitle">Content Template</h3>
        <p id="cSub">Draft the message content in English and Arabic</p>
      </div>
      <button class="modal-close" onclick="closeModal('contentModal')">√ó</button>
    </div>
    <div class="modal-body">
      <div id="cGoal"></div>
      <div id="cChannels"></div>
      <div class="lang-tabs">
        <button class="lang-tab on" onclick="setLang('en')">üá¨üáß &nbsp;English</button>
        <button class="lang-tab" onclick="setLang('ar')">üá¶üá™ &nbsp;ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
      </div>
      <div class="content-block show" id="enBlock">
        <div class="content-section">
          <div class="cs-lbl">Subject Line / Notification Title</div>
          <textarea class="cs-field" placeholder="e.g. Your contract is ready ‚Äî here's what happens next"></textarea>
        </div>
        <div class="content-section">
          <div class="cs-lbl">Message Opening / Salutation</div>
          <textarea class="cs-field" style="min-height:60px" placeholder="e.g. Dear [Name], we're pleased to confirm that‚Ä¶"></textarea>
        </div>
        <div class="content-section">
          <div class="cs-lbl">Main Body / Key Information</div>
          <textarea class="cs-field" style="min-height:110px" placeholder="Core message, key details, next steps, links‚Ä¶"></textarea>
        </div>
        <div class="content-section">
          <div class="cs-lbl">Call to Action</div>
          <textarea class="cs-field" style="min-height:55px" placeholder="e.g. Click here to sign your contract / Call us on‚Ä¶"></textarea>
        </div>
        <div class="content-section" style="margin-bottom:0">
          <div class="cs-lbl">Internal Notes (Team Reference)</div>
          <textarea class="cs-field" style="min-height:60px" placeholder="SLA, dependencies, escalation path, responsible team‚Ä¶"></textarea>
        </div>
      </div>
      <div class="content-block" id="arBlock">
        <div class="content-section">
          <div class="cs-lbl">ÿ≥ÿ∑ÿ± ÿßŸÑŸÖŸàÿ∂Ÿàÿπ / ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±</div>
          <textarea class="cs-field ar-field" placeholder="ŸÖÿ´ÿßŸÑ: ÿπŸÇÿØŸÉ ÿ¨ÿßŸáÿ≤ ‚Äî ÿ•ŸÑŸäŸÉ ŸÖÿß Ÿäÿ≠ÿØÿ´ ÿ®ÿπÿØ ÿ∞ŸÑŸÉ"></textarea>
        </div>
        <div class="content-section">
          <div class="cs-lbl">ÿßŸÅÿ™ÿ™ÿßÿ≠Ÿäÿ© ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© / ÿßŸÑÿ™ÿ≠Ÿäÿ©</div>
          <textarea class="cs-field ar-field" style="min-height:60px" placeholder="ŸÖÿ´ÿßŸÑ: ÿπÿ≤Ÿäÿ≤Ÿä [ÿßŸÑÿßÿ≥ŸÖ]ÿå Ÿäÿ≥ÿπÿØŸÜÿß ÿ™ÿ£ŸÉŸäÿØ ÿ£ŸÜ‚Ä¶"></textarea>
        </div>
        <div class="content-section">
          <div class="cs-lbl">ŸÜÿµ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä / ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©</div>
          <textarea class="cs-field ar-field" style="min-height:110px" placeholder="ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ŸàÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ ŸàÿßŸÑÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑÿ™ÿßŸÑŸäÿ©‚Ä¶"></textarea>
        </div>
        <div class="content-section">
          <div class="cs-lbl">ÿßŸÑÿØÿπŸàÿ© ÿ•ŸÑŸâ ÿßÿ™ÿÆÿßÿ∞ ÿ•ÿ¨ÿ±ÿßÿ°</div>
          <textarea class="cs-field ar-field" style="min-height:55px" placeholder="ŸÖÿ´ÿßŸÑ: ÿßŸÜŸÇÿ± ŸáŸÜÿß ŸÑÿ™ŸàŸÇŸäÿπ ÿπŸÇÿØŸÉ / ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß ÿπŸÑŸâ‚Ä¶"></textarea>
        </div>
        <div class="content-section" style="margin-bottom:0">
          <div class="cs-lbl">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿØÿßÿÆŸÑŸäÿ© (ŸÖÿ±ÿ¨ÿπ ÿßŸÑŸÅÿ±ŸäŸÇ)</div>
          <textarea class="cs-field ar-field" style="min-height:60px" placeholder="ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿÆÿØŸÖÿ©ÿå ÿßŸÑÿ™ÿ®ÿπŸäÿßÿ™ÿå ŸÖÿ≥ÿßÿ± ÿßŸÑÿ™ÿµÿπŸäÿØ‚Ä¶"></textarea>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="tt" id="tt"></div>
<div class="wm">Renascence ¬© 2024</div>

<script>
// ‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê
const TYPES = {
  NO:  { label:'Notification',     color:'#5b9ef7' },
  CO:  { label:'Confirmation',     color:'#3ecf7a' },
  RE:  { label:'Reminder',         color:'#f5a623' },
  LN:  { label:'Legal Notice',     color:'#f55a5a' },
  GU:  { label:'Guide',            color:'#22d3ee' },
  IN:  { label:'Invitation',       color:'#b07ef5' },
  FU:  { label:'Follow Up',        color:'#f97316' },
  UP:  { label:'Update',           color:'#e879a0' },
  VOC: { label:'Voice of Customer',color:'#14b8a6' },
};

const STAGES = [
  { id:'all',       label:'All Stages',            color:'#7b7ff5', sub:'Complete communications framework across the customer lifecycle' },
  { id:'booking',   label:'Booking & SPA',          color:'#5b9ef7', sub:'From first reservation through contract signing' },
  { id:'waiting',   label:'Waiting Period',         color:'#9b7ef5', sub:'Construction phase, updates and payment management' },
  { id:'handover',  label:'Handover',               color:'#22d3ee', sub:'Pre-handover, snagging, key collection and move-in' },
  { id:'living',    label:'Living',                 color:'#3ecf7a', sub:'Community, services, facility and resale communications' },
  { id:'marketing', label:'Marketing & Re-engagement', color:'#f5a623', sub:'Campaigns, launches, non-resident outreach' },
];

const CHANNELS = ['E-mail','SMS','WhatsApp','Portal','Call','Courier','Website','Social Media'];

const COMMS = [
  // BOOKING
  {id:1,  stage:'booking',  type:'NO', dept:'Sales',        channels:['E-mail'],                   timing:'Once',     trigger:'Booking',                   goal:'Transact', desc:'Unit reservation ‚Äî booking fee / deposit received (10%)'},
  {id:2,  stage:'booking',  type:'NO', dept:'Sales',        channels:['E-mail'],                   timing:'Once',     trigger:'Booking',                   goal:'Reassure', desc:'Notice of confirmation ‚Äî acceptance of booking form'},
  {id:3,  stage:'booking',  type:'NO', dept:'Sales',        channels:['E-mail'],                   timing:'Once',     trigger:'Booking',                   goal:'Inform',   desc:'Notice of cancellation ‚Äî purchase rejected'},
  {id:4,  stage:'booking',  type:'NO', dept:'Sales',        channels:['E-mail'],                   timing:'Once',     trigger:'Before SPA',                goal:'Inform',   desc:'SPA draft template ‚Äî payment plan adjustments'},
  {id:5,  stage:'booking',  type:'NO', dept:'Sales',        channels:['E-mail','Courier'],         timing:'Once',     trigger:'Before SPA signature',      goal:'Expedite', desc:'SPA issued and ready for signature (local buyers)'},
  {id:6,  stage:'booking',  type:'NO', dept:'Sales',        channels:['E-mail','Courier'],         timing:'Once',     trigger:'Before SPA signature',      goal:'Expedite', desc:'SPA issued and ready for signature (international buyers)'},
  {id:7,  stage:'booking',  type:'NO', dept:'Sales',        channels:['E-mail','SMS'],             timing:'Once',     trigger:'After SPA signature',       goal:'Guide',    desc:'SPA ready for collection ‚Äî pre-title deed registration completed'},
  {id:8,  stage:'booking',  type:'CO', dept:'CM',           channels:['E-mail','SMS'],             timing:'Once',     trigger:'After SPA collection',      goal:'Confirm',  desc:'SPA collected confirmation'},
  {id:9,  stage:'booking',  type:'NO', dept:'CM',           channels:['E-mail','SMS','Call'],      timing:'Repeated', trigger:'SPA signature +7d, +14d',   goal:'Nudge',    desc:'Pending SPA follow-up ‚Äî if not yet collected'},
  {id:10, stage:'booking',  type:'VOC',dept:'CM',           channels:['E-mail','WhatsApp'],        timing:'Repeated', trigger:'After SPA 0d, +3d, +7d',    goal:'Listen',   desc:'Rate your experience ‚Äî purchase process survey'},
  {id:11, stage:'booking',  type:'UP', dept:'Finance',      channels:['E-mail'],                   timing:'Once',     trigger:'After SPA signature',       goal:'Inform',   desc:'Bank account update ‚Äî escrow details communicated'},
  {id:12, stage:'booking',  type:'CO', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Once',     trigger:'After SPA signature',       goal:'Confirm',  desc:'1st installment received ‚Äî ADM payments confirmed'},
  {id:13, stage:'booking',  type:'GU', dept:'CM',           channels:['WhatsApp','E-mail'],        timing:'Once',     trigger:'After SPA signature',       goal:'Guide',    desc:'Customer guide ‚Äî process, contacts, and channels overview'},
  {id:14, stage:'booking',  type:'IN', dept:'CM',           channels:['E-mail','WhatsApp'],        timing:'Repeated', trigger:'SPA sign 0d, +7d, +30d',   goal:'Onboard',  desc:'Portal registration invitation ‚Äî benefits and service highlights'},
  {id:15, stage:'booking',  type:'CO', dept:'CM',           channels:['E-mail','WhatsApp'],        timing:'Once',     trigger:'After registration',        goal:'Welcome',  desc:'Thank you for registering ‚Äî benefits recap'},
  // WAITING
  {id:16, stage:'waiting',  type:'UP', dept:'CM',           channels:['Portal','E-mail','WhatsApp'],timing:'Monthly', trigger:'Every month',               goal:'Inform',   desc:'Minor construction progress update'},
  {id:17, stage:'waiting',  type:'UP', dept:'CM',           channels:['Portal','E-mail'],           timing:'Quarterly',trigger:'Every quarter',            goal:'Reassure', desc:'Major construction milestone update'},
  {id:18, stage:'waiting',  type:'RE', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Repeated', trigger:'Milestone -30d, -14d, -7d, 0d',goal:'Prepare',desc:'Upcoming milestone payment reminder'},
  {id:19, stage:'waiting',  type:'RE', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Repeated', trigger:'Milestone +7d, +14d, +30d', goal:'Recover',  desc:'Milestone payment overdue reminder'},
  {id:20, stage:'waiting',  type:'CO', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Once',     trigger:'After payment received',    goal:'Confirm',  desc:'Milestone payment received confirmation'},
  {id:21, stage:'waiting',  type:'RE', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Repeated', trigger:'Due date -30d, -14d, -7d, 0d',goal:'Prepare',desc:'Upcoming due date based payment reminder'},
  {id:22, stage:'waiting',  type:'RE', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Repeated', trigger:'Due date +7d, +14d, +30d',  goal:'Recover',  desc:'Due date payment overdue reminder'},
  {id:23, stage:'waiting',  type:'CO', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Once',     trigger:'After payment received',    goal:'Confirm',  desc:'Due date payment received confirmation'},
  {id:24, stage:'waiting',  type:'CO', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Once',     trigger:'After payment collected',   goal:'Confirm',  desc:'Cheque / wire transfer received ‚Äî installment'},
  {id:25, stage:'waiting',  type:'CO', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Once',     trigger:'After payment received',    goal:'Confirm',  desc:'Cheque cleared / wire transfer confirmed'},
  {id:26, stage:'waiting',  type:'NO', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Once',     trigger:'After payment failed',      goal:'Alert',    desc:'Cheque bounced / wire transfer failed ‚Äî payment not processed'},
  {id:27, stage:'waiting',  type:'RE', dept:'Finance',      channels:['E-mail','SMS','Call'],      timing:'Repeated', trigger:'Failed +7d, +14d, +30d',    goal:'Recover',  desc:'Replace cheque or provide sufficient funds'},
  {id:28, stage:'waiting',  type:'LN', dept:'Finance',      channels:['E-mail'],                   timing:'Once',     trigger:'Due date +30d',             goal:'Escalate', desc:'Default notice ‚Äî payment delayed beyond 30 days'},
  {id:29, stage:'waiting',  type:'LN', dept:'Finance',      channels:['E-mail','Courier','Portal','SMS'],timing:'Once',trigger:'Default notice +14d',    goal:'Escalate', desc:'Termination notice ‚Äî based on business decision'},
  // HANDOVER
  {id:30, stage:'handover', type:'NO', dept:'CM',           channels:['E-mail','Portal'],          timing:'Once',     trigger:'Before HO',                 goal:'Inform',   desc:'Building Completion Certificate issuance notice'},
  {id:31, stage:'handover', type:'RE', dept:'CM',           channels:['E-mail','WhatsApp'],        timing:'Once',     trigger:'Before HO',                 goal:'Nudge',    desc:'Follow up on portal registration ‚Äî if not yet registered'},
  {id:32, stage:'handover', type:'LN', dept:'CM',           channels:['E-mail','Courier','WhatsApp'],timing:'Once',   trigger:'HO date -90d',              goal:'Inform',   desc:'Handover notice ‚Äî formal notification to collect property'},
  {id:33, stage:'handover', type:'LN', dept:'CM',           channels:['E-mail','Courier','WhatsApp'],timing:'Once',   trigger:'Latest by HO date -90d',    goal:'Manage',   desc:'Notice of extension / delay with updated timeline'},
  {id:34, stage:'handover', type:'GU', dept:'CM',           channels:['E-mail','Portal','WhatsApp'],timing:'Once',    trigger:'Before HO',                 goal:'Guide',    desc:'Handover guide ‚Äî what to expect, what to bring'},
  {id:35, stage:'handover', type:'RE', dept:'Finance',      channels:['E-mail'],                   timing:'Once',     trigger:'HO notice +15d',            goal:'Prepare',  desc:'Settlement payment (final) ‚Äî first reminder'},
  {id:36, stage:'handover', type:'IN', dept:'CM',           channels:['E-mail','Portal','WhatsApp'],timing:'Once',    trigger:'Before HO',                 goal:'Invite',   desc:'Orientation / pre-snagging notice ‚Äî appointment invitation'},
  {id:37, stage:'handover', type:'CO', dept:'CM',           channels:['E-mail','Portal','WhatsApp'],timing:'Once',    trigger:'Before HO',                 goal:'Confirm',  desc:'Orientation / pre-snagging appointment confirmation'},
  {id:38, stage:'handover', type:'NO', dept:'CM',           channels:['E-mail','Portal','WhatsApp'],timing:'Once',    trigger:'Before HO',                 goal:'Document', desc:'Orientation / pre-snagging report shared with customer'},
  {id:39, stage:'handover', type:'RE', dept:'Finance',      channels:['E-mail'],                   timing:'Once',     trigger:'HO notice +30d',            goal:'Prepare',  desc:'Settlement payment (final) ‚Äî second reminder'},
  {id:40, stage:'handover', type:'IN', dept:'CM',           channels:['E-mail','Portal','WhatsApp'],timing:'Once',    trigger:'Before HO',                 goal:'Invite',   desc:'Snagging appointment invitation (post-rectification)'},
  {id:41, stage:'handover', type:'CO', dept:'CM',           channels:['E-mail','Portal','WhatsApp'],timing:'Once',    trigger:'Before HO',                 goal:'Confirm',  desc:'Snagging appointment confirmed'},
  {id:42, stage:'handover', type:'NO', dept:'CM',           channels:['E-mail','Portal'],          timing:'Once',     trigger:'Before HO',                 goal:'Document', desc:'Snagging report shared with customer'},
  {id:43, stage:'handover', type:'NO', dept:'CM',           channels:['E-mail','Portal'],          timing:'Once',     trigger:'Before HO',                 goal:'Inform',   desc:'Snagging rectification ‚Äî work completed notification'},
  {id:44, stage:'handover', type:'NO', dept:'CM',           channels:['E-mail','Portal'],          timing:'Once',     trigger:'Before HO',                 goal:'Close',    desc:'Snagging sign-off report ‚Äî formal sign-off confirmation'},
  {id:45, stage:'handover', type:'VOC',dept:'CM',           channels:['E-mail','WhatsApp'],        timing:'Repeated', trigger:'After sign-off 0d, +3d, +7d',goal:'Listen',  desc:'Rate your orientation and snagging experience'},
  {id:46, stage:'handover', type:'RE', dept:'Finance',      channels:['E-mail'],                   timing:'Once',     trigger:'HO date',                   goal:'Prepare',  desc:'Settlement payment (final) ‚Äî HO date reminder'},
  {id:47, stage:'handover', type:'RE', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Repeated', trigger:'HO +7d, +14d, +30d',        goal:'Recover',  desc:'Settlement payment overdue ‚Äî final payment reminder series'},
  {id:48, stage:'handover', type:'CO', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Once',     trigger:'After payment received',    goal:'Confirm',  desc:'Settlement payment received ‚Äî final installment confirmed'},
  {id:49, stage:'handover', type:'LN', dept:'Finance',      channels:['E-mail'],                   timing:'Once',     trigger:'Due date +45d',             goal:'Escalate', desc:'Default notice ‚Äî final payment delayed beyond 30 days'},
  {id:50, stage:'handover', type:'LN', dept:'Finance',      channels:['E-mail','Courier','Portal','SMS'],timing:'Once',trigger:'Default notice +14d',     goal:'Escalate', desc:'Termination notice ‚Äî final stage, business decision'},
  {id:51, stage:'handover', type:'IN', dept:'CM',           channels:['E-mail','WhatsApp'],        timing:'Once',     trigger:'Before HO',                 goal:'Invite',   desc:'Key collection appointment and NOC invitation'},
  {id:52, stage:'handover', type:'NO', dept:'CM',           channels:['E-mail','Portal'],          timing:'Once',     trigger:'During HO',                 goal:'Inform',   desc:'Warranty document and DLP details ‚Äî inclusions and terms'},
  {id:53, stage:'handover', type:'GU', dept:'CM',           channels:['E-mail','WhatsApp','Portal'],timing:'Once',    trigger:'During HO',                 goal:'Guide',    desc:"Homeowners' manual ‚Äî unit operations and community guide"},
  {id:54, stage:'handover', type:'NO', dept:'CM',           channels:['E-mail','WhatsApp'],        timing:'Once',     trigger:'After HO',                  goal:'Inform',   desc:'Title deed initiation ‚Äî process started'},
  {id:55, stage:'handover', type:'CO', dept:'CM',           channels:['E-mail','WhatsApp'],        timing:'Once',     trigger:'After title deed issued',   goal:'Celebrate',desc:'Title deed issued ‚Äî ownership transferred'},
  {id:56, stage:'handover', type:'VOC',dept:'CM',           channels:['E-mail','WhatsApp'],        timing:'Repeated', trigger:'After HO 0d, +3d, +7d',     goal:'Listen',   desc:'Rate your handover experience survey'},
  {id:57, stage:'handover', type:'NO', dept:'CM',           channels:['E-mail'],                   timing:'Once',     trigger:'After HO',                  goal:'Onboard',  desc:'Introduction to Property Management ‚Äî contacts and move-in info'},
  {id:58, stage:'handover', type:'NO', dept:'Prop.Mgmt',    channels:['E-mail'],                   timing:'Once',     trigger:'After HO',                  goal:'Onboard',  desc:'Property management portal login credentials'},
  {id:59, stage:'handover', type:'CO', dept:'Prop.Mgmt',    channels:['E-mail','WhatsApp'],        timing:'Once',     trigger:'After registration',        goal:'Welcome',  desc:'Thank you for registering on the property portal'},
  {id:60, stage:'handover', type:'GU', dept:'Prop.Mgmt',    channels:['E-mail','Portal','WhatsApp'],timing:'Once',    trigger:'After HO',                  goal:'Guide',    desc:'Move-in guide and checklist ‚Äî preparation and to-do list'},
  {id:61, stage:'handover', type:'CO', dept:'Prop.Mgmt',    channels:['E-mail','Portal'],          timing:'Once',     trigger:'After HO',                  goal:'Confirm',  desc:'Move-in permit confirmed'},
  {id:62, stage:'handover', type:'NO', dept:'Prop.Mgmt',    channels:['E-mail','Portal','WhatsApp'],timing:'Once',    trigger:'After HO',                  goal:'Delight',  desc:'Value added 3rd party services ‚Äî movers, landscaping, brokers'},
  // LIVING
  {id:63, stage:'living',   type:'NO', dept:'Prop.Mgmt',    channels:['E-mail','Portal','WhatsApp'],timing:'Once',    trigger:'After move-in',             goal:'Welcome',  desc:'Welcome to the community ‚Äî first official resident interaction'},
  {id:64, stage:'living',   type:'VOC',dept:'Prop.Mgmt',    channels:['E-mail','WhatsApp'],        timing:'Once',     trigger:'After move-in',             goal:'Listen',   desc:'Rate your move-in experience'},
  {id:65, stage:'living',   type:'VOC',dept:'Prop.Mgmt',    channels:['E-mail','WhatsApp'],        timing:'Every 6m', trigger:'After move-in',             goal:'Listen',   desc:'Rate your living experience ‚Äî ongoing pulse survey'},
  {id:66, stage:'living',   type:'RE', dept:'CM',           channels:['E-mail','Portal','WhatsApp'],timing:'Repeated',trigger:'DLP expiry -30d, -15d',      goal:'Inform',   desc:'DLP expiry reminder ‚Äî defects liability period ending soon'},
  {id:67, stage:'living',   type:'NO', dept:'CM',           channels:['E-mail','WhatsApp'],        timing:'Once',     trigger:'On DLP expiry date',        goal:'Support',  desc:'DLP expired ‚Äî suggested contractor list provided'},
  {id:68, stage:'living',   type:'NO', dept:'Prop.Mgmt',    channels:['E-mail','Portal','WhatsApp'],timing:'Repeated',trigger:'HO +30d, +60d',             goal:'Engage',   desc:'Portal service highlights ‚Äî parking, access cards, additional services'},
  {id:69, stage:'living',   type:'UP', dept:'Prop.Mgmt',    channels:['E-mail','Portal'],          timing:'Monthly',  trigger:'As required',               goal:'Engage',   desc:'Community newsletter ‚Äî updates, events, and notices'},
  {id:70, stage:'living',   type:'UP', dept:'Prop.Mgmt',    channels:['E-mail','WhatsApp','Portal'],timing:'Monthly', trigger:'As required',               goal:'Engage',   desc:'Community events announcements'},
  {id:71, stage:'living',   type:'UP', dept:'Facilities',   channels:['E-mail','Portal','WhatsApp'],timing:'Monthly', trigger:'As required',               goal:'Inform',   desc:'Facility management info ‚Äî maintenance, works, service updates'},
  {id:72, stage:'living',   type:'NO', dept:'Prop.Mgmt',    channels:['E-mail','Portal'],          timing:'Once',     trigger:'When triggered',            goal:'Inform',   desc:'Statement of Account (SOA) ‚Äî request-based, triggered on demand'},
  {id:73, stage:'living',   type:'NO', dept:'Prop.Mgmt',    channels:['E-mail','Portal'],          timing:'Yearly',   trigger:'After HO annually',         goal:'Inform',   desc:'Detailed service charges review ‚Äî annual breakdown'},
  {id:74, stage:'living',   type:'UP', dept:'Prop.Mgmt',    channels:['E-mail','Portal'],          timing:'Quarterly',trigger:'As required',               goal:'Engage',   desc:'Community newsletter ‚Äî service updates and renovations'},
  {id:75, stage:'living',   type:'NO', dept:'Prop.Mgmt',    channels:['E-mail','Portal'],          timing:'Once',     trigger:'After HO',                  goal:'Onboard',  desc:'Portal services overview ‚Äî highlights and updates for owners'},
  {id:76, stage:'living',   type:'RE', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Repeated', trigger:'PHPP -30d, -14d, -7d, 0d',  goal:'Prepare',  desc:'Upcoming PHPP payment reminder series'},
  {id:77, stage:'living',   type:'RE', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Repeated', trigger:'PHPP +7d, +14d, +30d',      goal:'Recover',  desc:'PHPP payment overdue reminder'},
  {id:78, stage:'living',   type:'CO', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Once',     trigger:'After payment received',    goal:'Confirm',  desc:'PHPP installment received confirmation'},
  {id:79, stage:'living',   type:'LN', dept:'Finance',      channels:['E-mail'],                   timing:'Once',     trigger:'PHPP due date +30d',        goal:'Escalate', desc:'PHPP default notice ‚Äî payment delayed beyond 30 days'},
  {id:80, stage:'living',   type:'RE', dept:'Finance',      channels:['E-mail','SMS','Portal'],    timing:'Repeated', trigger:'Service charge -30d, -7d, 0d',goal:'Prepare', desc:'Upcoming service charge payment reminder'},
  {id:81, stage:'living',   type:'RE', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Repeated', trigger:'Due date +7d, +14d, +30d',  goal:'Recover',  desc:'Service charge payment overdue'},
  {id:82, stage:'living',   type:'CO', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Once',     trigger:'After payment received',    goal:'Confirm',  desc:'Service charge payment received'},
  {id:83, stage:'living',   type:'NO', dept:'CM',           channels:['E-mail','Portal'],          timing:'Once',     trigger:'When triggered',            goal:'Support',  desc:'Property resale process ‚Äî information and required documents'},
  {id:84, stage:'living',   type:'CO', dept:'CM',           channels:['E-mail','Portal'],          timing:'Once',     trigger:'After docs received',       goal:'Confirm',  desc:'Resale documents received confirmation'},
  {id:85, stage:'living',   type:'RE', dept:'CM',           channels:['E-mail','Portal'],          timing:'Once',     trigger:'Docs due date +7d',         goal:'Recover',  desc:'Resale documents missing ‚Äî follow-up reminder'},
  {id:86, stage:'living',   type:'CO', dept:'CM',           channels:['E-mail','Portal'],          timing:'Once',     trigger:'After documents verified',  goal:'Confirm',  desc:'Resale documents cleared and verified'},
  {id:87, stage:'living',   type:'CO', dept:'Finance',      channels:['E-mail','SMS'],             timing:'Once',     trigger:'After payment received',    goal:'Confirm',  desc:'Resale payment received'},
  {id:88, stage:'living',   type:'CO', dept:'CM',           channels:['E-mail','SMS','WhatsApp'],  timing:'Once',     trigger:'After resale completed',    goal:'Close',    desc:'Resale completed ‚Äî NOC issued, mortgage discharged'},
  {id:89, stage:'living',   type:'CO', dept:'Prop.Mgmt',    channels:['E-mail','Portal'],          timing:'Once',     trigger:'Before move-out',           goal:'Confirm',  desc:'Move-out permit confirmed'},
  {id:90, stage:'living',   type:'NO', dept:'Prop.Mgmt',    channels:['E-mail','Portal','WhatsApp'],timing:'Once',    trigger:'Before move-out',           goal:'Support',  desc:'Value added 3rd party services for move-out ‚Äî painters, movers'},
  {id:91, stage:'living',   type:'GU', dept:'Prop.Mgmt',    channels:['E-mail','Portal','WhatsApp'],timing:'Once',    trigger:'Before move-out',           goal:'Guide',    desc:'Move-out guide and checklist ‚Äî preparation and handback process'},
  {id:92, stage:'living',   type:'NO', dept:'Prop.Mgmt',    channels:['E-mail'],                   timing:'Once',     trigger:'After move-out',            goal:'Retain',   desc:'We will miss you ‚Äî warm departure message'},
  {id:93, stage:'living',   type:'VOC',dept:'Prop.Mgmt',    channels:['E-mail','WhatsApp'],        timing:'Once',     trigger:'After move-out',            goal:'Listen',   desc:'Rate your move-out experience'},
  // MARKETING
  {id:94, stage:'marketing',type:'UP', dept:'Marketing',    channels:['Website','Social Media'],   timing:'Monthly',  trigger:'Beginning of month',        goal:'Attract',     desc:'New project launches and campaigns ‚Äî website and social channels'},
  {id:95, stage:'marketing',type:'UP', dept:'Marketing',    channels:['Website','Social Media'],   timing:'Monthly',  trigger:'As required',               goal:'Build Brand',  desc:'Developer content ‚Äî company story, values, sustainability and CSR'},
  {id:96, stage:'marketing',type:'UP', dept:'Marketing',    channels:['Website','Social Media'],   timing:'Monthly',  trigger:'As required',               goal:'Build Trust',  desc:'Milestone construction updates ‚Äî general public content'},
  {id:97, stage:'marketing',type:'UP', dept:'Marketing',    channels:['E-mail','WhatsApp','Portal'],timing:'Monthly', trigger:'Beginning of month',        goal:'Upsell',      desc:'New launches and offers ‚Äî direct to existing customer database'},
  {id:98, stage:'marketing',type:'IN', dept:'Marketing',    channels:['E-mail','WhatsApp'],        timing:'Monthly',  trigger:'Beginning of month',        goal:'Engage',      desc:'Invitation to project launches ‚Äî current residents and buyers'},
  {id:99, stage:'marketing',type:'UP', dept:'Marketing',    channels:['E-mail','Portal','WhatsApp'],timing:'Monthly', trigger:'As required',               goal:'Inform',      desc:'Events and operational updates ‚Äî relocations, new hours, changes'},
  {id:100,stage:'marketing',type:'UP', dept:'Marketing',    channels:['E-mail','WhatsApp'],        timing:'Monthly',  trigger:'Beginning of month',        goal:'Educate',     desc:'Property trend newsletters ‚Äî market insights and reports'},
  {id:101,stage:'marketing',type:'UP', dept:'Marketing',    channels:['E-mail','WhatsApp','Call'], timing:'Quarterly',trigger:'Beginning of month',        goal:'Reactivate',  desc:'New launches and campaigns ‚Äî non-resident re-engagement'},
  {id:102,stage:'marketing',type:'IN', dept:'Marketing',    channels:['E-mail','WhatsApp','Call'], timing:'Monthly',  trigger:'Beginning of month',        goal:'Reactivate',  desc:'Invitation to project launches ‚Äî non-resident audience'},
  {id:103,stage:'marketing',type:'NO', dept:'Marketing',    channels:['E-mail','WhatsApp'],        timing:'Quarterly',trigger:'Beginning of month',        goal:'Enable',      desc:'Information about purchase channels ‚Äî non-residents'},
  {id:104,stage:'marketing',type:'UP', dept:'Marketing',    channels:['E-mail','WhatsApp'],        timing:'Monthly',  trigger:'Beginning of month',        goal:'Educate',     desc:'Property trend newsletters ‚Äî non-resident audience'},
];

// ‚ïê‚ïê‚ïê REAL-LIFE PROCESS MAPS ‚ïê‚ïê‚ïê
const PROCESS_MAPS = {

  NO: {
    title: 'Notification',
    overview: 'A notification is a one-way, fact-based alert sent to the customer when a defined system event or business milestone occurs. The process originates in the CRM or a connected operational system and must complete within the SLA window to avoid customer confusion or escalation.',
    origin: 'CRM system event, ERP status change, or manual trigger by responsible department team lead.',
    steps: [
      {
        phase: 'Trigger',
        icon: '‚ö°',
        color: '#5b9ef7',
        title: 'Event fires in source system',
        desc: 'A status field changes in CRM (e.g. SPA_Status = Collected, Payment_Status = Received). The event fires a webhook or updates a Data Extension row that SFMC monitors in real time.',
        tools: ['Salesforce CRM', 'SFMC Triggered Send', 'REST API Event'],
        sla: 'Trigger detected within 2 minutes of status change',
        dependency: 'CRM-SFMC data sync must be live; field mapping validated',
        owner: 'CRM Administrator'
      },
      {
        phase: 'Validation',
        icon: '‚úì',
        color: '#3ecf7a',
        title: 'Record validation & suppression check',
        desc: 'Before any send, the system verifies: (a) contact has a valid email/mobile, (b) contact is not on the global opt-out list, (c) the same notification has not already been sent for this event ID. Duplicates are blocked automatically.',
        tools: ['SFMC Suppression List', 'Contact Builder', 'Data Extension query'],
        sla: 'Validation completes within 30 seconds',
        dependency: 'Suppression lists refreshed daily; contact records complete',
        owner: 'SFMC Administrator'
      },
      {
        phase: 'Personalisation',
        icon: '‚óà',
        color: '#b07ef5',
        title: 'Dynamic content population',
        desc: 'AMPscript or Personalisation Strings pull relevant data from the contact record: name, unit number, project name, relevant dates, assigned agent contact, and portal deep-link. Language is determined by Preferred_Language field (EN/AR).',
        tools: ['SFMC AMPscript', 'Content Builder', 'CRM contact attributes'],
        sla: 'Render time under 3 seconds per record',
        dependency: 'Template pre-approved by Comms team; all merge fields populated',
        owner: 'Communications Team'
      },
      {
        phase: 'Send',
        icon: '‚Üí',
        color: '#22d3ee',
        title: 'Dispatch via configured channel',
        desc: 'Email sends via SFMC Email Studio using the approved sender domain. SMS sends via connected SMS gateway (e.g. Twilio or local aggregator). WhatsApp sends via approved WhatsApp Business API using a pre-approved HSM template. Sends are logged with a unique event ID.',
        tools: ['SFMC Email Studio', 'SMS Gateway (Twilio/local)', 'WhatsApp Business API', 'SFMC MobileConnect'],
        sla: 'Email delivered within 5 min ¬∑ SMS within 2 min ¬∑ WhatsApp within 1 min of send',
        dependency: 'Sender domain authenticated (SPF/DKIM); WA template pre-approved by Meta',
        owner: 'SFMC Administrator'
      },
      {
        phase: 'Logging',
        icon: '‚äû',
        color: '#f5a623',
        title: 'Activity logged to CRM & Analytics',
        desc: 'Send event (with timestamp, channel, and template ID) is written back to the CRM contact timeline via API. Delivery and open events flow into SFMC Analytics Builder. Failed deliveries trigger an alert to the responsible team.',
        tools: ['SFMC Journey Analytics', 'CRM Activity Feed', 'Email / SMS delivery webhook'],
        sla: 'CRM updated within 10 minutes of send confirmation',
        dependency: 'CRM API writeback credentials valid; Analytics Builder report configured',
        owner: 'CRM Administrator + CX Manager'
      }
    ],
    waitTimes: [{ label:'Trigger ‚Üí Send', time:'< 10 min end-to-end' }, { label:'CRM writeback', time:'< 10 min post-send' }],
    escalation: 'If send fails after 3 retries, an alert email goes to the SFMC Admin and department head. The CRM record is flagged for manual follow-up within 1 business day.'
  },

  CO: {
    title: 'Confirmation',
    overview: 'A confirmation closes a loop ‚Äî it tells the customer that an action they or the company took has been recorded and accepted. It must be sent fast (ideally within minutes of the event) to build trust and reduce inbound inquiry volume.',
    origin: 'Transaction completed in CRM, payment gateway, or property management portal. Event fires synchronously with the completing action.',
    steps: [
      {
        phase: 'Trigger',
        icon: '‚ö°',
        color: '#5b9ef7',
        title: 'Transaction event confirmed in source system',
        desc: 'A completed transaction (SPA collected, payment cleared, document signed) updates the relevant system record. A real-time webhook fires immediately to SFMC Triggered Send. A 90-second buffer wait is built in to allow all data propagation across integrated systems before content is assembled.',
        tools: ['Salesforce CRM', 'Payment Gateway webhook', 'Property Portal API', 'SFMC Triggered Send'],
        sla: 'Webhook must fire within 60 seconds of transaction completion',
        dependency: 'Webhook endpoint live and monitored; retry logic configured (3 attempts, 30s apart)',
        owner: 'IT Integration Team'
      },
      {
        phase: 'Data Pull',
        icon: '‚óà',
        color: '#b07ef5',
        title: 'Transaction data assembled for confirmation',
        desc: 'CRM API call fetches the full transaction record: amount, date, reference number, next step details, assigned relationship manager. This data is merged into the confirmation template in real time. If the data pull fails, the send is queued for retry ‚Äî not skipped.',
        tools: ['SFMC AMPscript', 'Salesforce API', 'Content Builder dynamic blocks'],
        sla: 'Data pull must complete within 20 seconds; retry on failure after 60s',
        dependency: 'API credentials valid; transaction record fully populated before webhook fires',
        owner: 'SFMC Administrator'
      },
      {
        phase: 'Approval Gate',
        icon: '‚¨°',
        color: '#f55a5a',
        title: 'Legal/Finance check for high-value confirmations',
        desc: 'For confirmations involving legal documents (SPA, title deed, LN clearance) or payments above a defined threshold, an approval step is required. The confirmation is held in a pending queue and a Slack/email alert is sent to the authorising manager. SLA: 2 hours max hold time during business hours.',
        tools: ['SFMC Interaction Studio', 'Slack notification webhook', 'Approval workflow in CRM'],
        sla: 'Approval within 2 business hours; auto-escalation to HOD if not actioned',
        dependency: 'Approver list maintained in CRM; out-of-office cover assigned',
        owner: 'Legal Team / Finance Manager'
      },
      {
        phase: 'Send',
        icon: '‚Üí',
        color: '#22d3ee',
        title: 'Confirmation dispatched ‚Äî dual channel',
        desc: 'Primary channel (Email) fires first with full confirmation details and reference number. Secondary channel (SMS) fires simultaneously with a short-form confirmation and reference number only. Both sends reference the same event ID so analytics can deduplicate engagement.',
        tools: ['SFMC Email Studio', 'SFMC MobileConnect', 'SMS Gateway'],
        sla: 'Email within 5 min ¬∑ SMS within 2 min of approval (or trigger if no approval needed)',
        dependency: 'Both channels configured per communication; SMS template character limit respected',
        owner: 'Communications Team'
      },
      {
        phase: 'CRM Update',
        icon: '‚äû',
        color: '#3ecf7a',
        title: 'Confirmation event logged, next step flagged',
        desc: 'Send confirmation is written to the CRM contact timeline. The next expected action (e.g. portal registration, appointment booking) is created as a task or reminder in CRM, assigned to the responsible team. Confirmation also updates the customer-facing portal activity log.',
        tools: ['Salesforce CRM Task', 'Customer Portal API', 'SFMC Analytics'],
        sla: 'CRM task created within 15 min of confirmation send',
        dependency: 'Portal API live; CRM task templates pre-configured per comm type',
        owner: 'CRM Administrator + Department Lead'
      }
    ],
    waitTimes: [{ label:'Transaction ‚Üí Email', time:'< 5 min (no approval) / < 2h (approval needed)' }, { label:'CRM task creation', time:'< 15 min post-send' }],
    escalation: 'If confirmation is not sent within SLA, the CRM auto-flags the transaction for manual follow-up. Department head receives daily digest of failed confirmations.'
  },

  RE: {
    title: 'Reminder',
    overview: 'Reminders are time-sensitive, date-driven communications that prevent missed payments, lapsed actions, and escalation into legal territory. They run on automated schedules and must be intelligent enough to suppress themselves once the action is completed ‚Äî otherwise they erode trust.',
    origin: 'Date-based automation in SFMC reads a Data Extension daily. When a due date falls within the configured threshold window, the reminder journey is triggered for that contact.',
    steps: [
      {
        phase: 'Scheduling',
        icon: '‚è±',
        color: '#b07ef5',
        title: 'Daily automation checks due dates',
        desc: 'An SFMC Automation Studio scheduled automation runs daily at 07:00 (local time). It queries a Data Extension containing all outstanding due dates (payment milestones, appointments, document deadlines). Any record where Due_Date falls within the configured window (e.g. 30, 14, 7, 0 days) is added to the reminder send queue.',
        tools: ['SFMC Automation Studio', 'SQL Query Activity', 'Data Extension: Due_Dates_DE'],
        sla: 'Automation must complete by 08:00; alert if runtime exceeds 45 min',
        dependency: 'Due_Dates_DE refreshed nightly from CRM; date fields in UTC standardised',
        owner: 'SFMC Administrator'
      },
      {
        phase: 'Suppression',
        icon: '‚úì',
        color: '#3ecf7a',
        title: 'Action completed? Suppress the reminder',
        desc: 'Before any reminder fires, a real-time lookup checks whether the action has already been completed (e.g. payment received = True, appointment confirmed = True). Completed records are excluded from the send. This is the most critical step ‚Äî sending a reminder for a completed action is a significant CX failure.',
        tools: ['SFMC Decision Split', 'CRM real-time API lookup', 'Data Extension join query'],
        sla: 'Suppression check must run within 1 hour of send window',
        dependency: 'CRM payment/action status synced to SFMC DE daily and on any status change event',
        owner: 'CRM Administrator'
      },
      {
        phase: 'Escalation Logic',
        icon: '‚Üë',
        color: '#f55a5a',
        title: 'Cadence escalation ‚Äî tone and urgency',
        desc: 'Reminders follow an escalating tone cadence: Day -30 is informational and friendly. Day -14 is a gentle nudge with clear instructions. Day -7 is direct with consequences outlined. Day 0 is urgent. Post-due-date reminders are flagged for potential LN escalation and routed through Legal sign-off before sending.',
        tools: ['SFMC Journey Builder path logic', 'Content Builder tone variants', 'Legal approval workflow'],
        sla: 'Post-due reminders require Legal sign-off within 4 business hours',
        dependency: 'Tone-variant templates pre-approved; Legal team notified of post-due threshold',
        owner: 'Communications Team + Legal Team'
      },
      {
        phase: 'Send',
        icon: '‚Üí',
        color: '#22d3ee',
        title: 'Multi-channel reminder dispatch',
        desc: 'Email is the primary channel for detailed reminders (payment instructions, bank details, deadline). SMS sends simultaneously as a short-form nudge. If previous reminders on the same series went unopened (tracked via email open), the next reminder adds a call-to-action to contact the relationship manager directly.',
        tools: ['SFMC Email Studio', 'SFMC MobileConnect', 'Engagement tracking (opens/clicks)'],
        sla: 'All sends complete within 2 hours of automation completion',
        dependency: 'Engagement tracking live; mobile numbers validated in contact record',
        owner: 'Communications Team'
      },
      {
        phase: 'Escalation Handoff',
        icon: '‚¨°',
        color: '#f5a623',
        title: 'Final reminder triggers manual outreach task',
        desc: 'When the final reminder in the series fires (Day 0 or first post-due), an automatic CRM task is created and assigned to the customer\'s relationship manager: "Call customer re: outstanding [action] ‚Äî due date passed." Task SLA is 1 business day. If the task remains open after 3 days, it escalates to department head.',
        tools: ['Salesforce CRM Task', 'Slack notification', 'CRM escalation workflow'],
        sla: 'Task created within 30 min of final reminder send; completed within 1 business day',
        dependency: 'Relationship manager assigned to every active customer record',
        owner: 'Department Head + Relationship Manager'
      }
    ],
    waitTimes: [{ label:'Automation run', time:'Daily at 07:00' }, { label:'Send window', time:'08:00‚Äì10:00 (avoid evening sends)' }, { label:'Post-due legal gate', time:'< 4 business hours' }],
    escalation: 'Three missed sends in a row trigger an SFMC Admin alert. Customer records with 2+ overdue reminders are flagged in a daily CX dashboard for HOD review.'
  },

  LN: {
    title: 'Legal Notice',
    overview: 'Legal notices are the highest-stakes communications in the ecosystem. They carry contractual and legal weight, must be traceable, and require multi-party approval before dispatch. Speed is secondary to accuracy and auditability.',
    origin: 'Legal or Finance team identifies a threshold breach (payment overdue beyond contractual grace period, or contract default). A case is created in CRM and escalated to Legal.',
    steps: [
      {
        phase: 'Case Creation',
        icon: '‚¨°',
        color: '#f55a5a',
        title: 'Breach identified and case opened in CRM',
        desc: 'Finance or CRM automation detects that a payment has not been received X days beyond the contractual due date (e.g. 30 days). A legal case record is automatically created in CRM, linked to the customer contract and all relevant payment records. The Legal team receives an immediate notification.',
        tools: ['Salesforce CRM Case Management', 'Finance ERP integration', 'Slack / email alert'],
        sla: 'Case created within 1 business day of breach detection',
        dependency: 'CRM-Finance sync accurate; contractual thresholds configured in system',
        owner: 'Finance Team + CRM Administrator'
      },
      {
        phase: 'Legal Review',
        icon: '‚úì',
        color: '#3ecf7a',
        title: 'Legal team reviews case and approves notice',
        desc: 'Legal team reviews the case record, verifies payment history, checks for any side agreements or exceptions, and selects the appropriate notice template (default notice vs. termination notice). They confirm the correct delivery addresses (email + courier physical address) and sign off the notice content.',
        tools: ['CRM Case record', 'DocuSign or document management system', 'Legal template library'],
        sla: 'Legal review and approval within 2 business days of case creation',
        dependency: 'Customer address details up to date; physical address verified for courier send',
        owner: 'Legal Team'
      },
      {
        phase: 'Senior Approval',
        icon: '‚¨°',
        color: '#b07ef5',
        title: 'HOD / Senior Management final sign-off',
        desc: 'Before any legal notice is dispatched, a senior-level approval is required (Department Head or CEO delegate, depending on notice value). An approval request is sent via CRM workflow. The approver has 24 hours to confirm or reject. A rejection requires the case to return to Legal review.',
        tools: ['CRM Approval workflow', 'DocuSign', 'Email notification to approver'],
        sla: 'Senior approval within 24 business hours',
        dependency: 'Approver hierarchy configured in CRM; backup approver designated',
        owner: 'Department Head / CEO Delegate'
      },
      {
        phase: 'Dispatch',
        icon: '‚Üí',
        color: '#22d3ee',
        title: 'Multi-channel dispatch with tracking',
        desc: 'Primary channel is Courier (physical tracked delivery) ‚Äî required for legal enforceability. Simultaneously: a formal email is sent from a legal sender address (not the standard marketing address). SMS notification confirms notice has been issued. All sends reference the case number and are logged with timestamps.',
        tools: ['Courier service (DHL / local)', 'SFMC Triggered Email (legal sender)', 'CRM case update'],
        sla: 'Email within 1h of approval ¬∑ Courier booked same business day',
        dependency: 'Courier account active; legal sender domain separate from marketing domain',
        owner: 'Legal Team + Communications Team'
      },
      {
        phase: 'Audit & Archive',
        icon: '‚äû',
        color: '#f5a623',
        title: 'Full audit trail created and archived',
        desc: 'Courier tracking number, email send timestamp, and delivery confirmation are all logged against the CRM case record. Physical and digital copies of the notice are stored in the document management system. Courier delivery confirmation updates the case status. If delivery fails, Legal team is alerted immediately for alternative service.',
        tools: ['Courier tracking API', 'Document Management System', 'CRM Case timeline', 'SFMC send log'],
        sla: 'All records archived within 2 business days of confirmed delivery',
        dependency: 'Document system access granted to Legal team; courier API integrated',
        owner: 'Legal Team + CRM Administrator'
      }
    ],
    waitTimes: [{ label:'Breach ‚Üí Case', time:'< 1 business day' }, { label:'Legal review', time:'2 business days' }, { label:'Senior approval', time:'24 business hours' }, { label:'Email dispatch', time:'< 1h post-approval' }, { label:'Courier delivery', time:'1‚Äì3 business days (local)' }],
    escalation: 'If courier delivery fails twice, Legal team initiates alternative service process (process server or registered post). All failed delivery attempts are documented for potential litigation use.'
  },

  GU: {
    title: 'Guide',
    overview: 'Guides are rich content assets that equip customers with everything they need to navigate a milestone ‚Äî handover, move-in, snagging, or portal use. They are not simple notifications; they require asset management, portal hosting, and engagement tracking.',
    origin: 'Journey milestone event in CRM (SPA signed, HO date confirmed, portal registered). The milestone triggers the guide dispatch workflow.',
    steps: [
      {
        phase: 'Asset Readiness',
        icon: '‚óà',
        color: '#b07ef5',
        title: 'Guide asset version check',
        desc: 'Before sending, the system checks that the latest approved version of the guide PDF/portal page is live and accessible. Content is version-controlled ‚Äî if the asset has been updated in the last 30 days, the Communications team is alerted to confirm the correct version is in use.',
        tools: ['Document Management System', 'Customer Portal CMS', 'Version control log'],
        sla: 'Asset version confirmed within 1 business day of milestone trigger',
        dependency: 'Guide reviewed and approved by Comms + Legal on every major update',
        owner: 'Communications Team'
      },
      {
        phase: 'Personalisation',
        icon: '‚ö°',
        color: '#5b9ef7',
        title: 'Deep link and unit data injected',
        desc: 'A personalised portal deep link is generated for each customer, pre-authenticated so they land directly on their relevant guide section without needing to log in again. Dynamic fields inject unit number, project name, handover date, snagging contact name, and relationship manager details.',
        tools: ['Customer Portal API', 'SFMC AMPscript', 'CRM contact data'],
        sla: 'Personalised link generated within 5 minutes of trigger',
        dependency: 'Portal SSO/deep link API active; customer has portal account',
        owner: 'IT Team + SFMC Administrator'
      },
      {
        phase: 'Send',
        icon: '‚Üí',
        color: '#22d3ee',
        title: 'Guide delivered via email + WhatsApp',
        desc: 'Email delivers the full guide as a PDF attachment (max 5MB) and includes the portal deep link. WhatsApp sends the portal link only (no attachment), formatted as an approved HSM template. Portal also shows a notification banner directing the customer to the guide.',
        tools: ['SFMC Email Studio', 'WhatsApp Business API', 'Customer Portal notification system'],
        sla: 'Email within 5 min ¬∑ WhatsApp within 2 min of send trigger',
        dependency: 'PDF under 5MB; WA template pre-approved; portal notification system live',
        owner: 'Communications Team'
      },
      {
        phase: 'Engagement Tracking',
        icon: '‚äû',
        color: '#3ecf7a',
        title: 'Open and access monitoring',
        desc: 'SFMC tracks email opens and PDF/link clicks. Portal analytics tracks time on guide page. If the guide email is unopened after 7 days, an automated follow-up nudge is sent via WhatsApp. If still no engagement after 14 days, a CRM task is created for the relationship manager to call the customer.',
        tools: ['SFMC Analytics Builder', 'Portal Analytics', 'CRM task automation'],
        sla: 'Follow-up nudge at Day +7; CRM task at Day +14 if still no engagement',
        dependency: 'Email tracking pixels enabled; portal session tracking configured',
        owner: 'CX Manager + Relationship Manager'
      }
    ],
    waitTimes: [{ label:'Milestone ‚Üí Email', time:'< 10 min' }, { label:'WhatsApp', time:'< 5 min' }, { label:'Follow-up if unopened', time:'Day +7' }, { label:'Manual outreach task', time:'Day +14' }],
    escalation: 'If a customer has not accessed their handover guide within 14 days of their handover date, the case is escalated to the Community Management lead for direct phone outreach.'
  },

  IN: {
    title: 'Invitation',
    overview: 'Invitations drive attendance and RSVP commitment for events, appointments, and project launches. They require capacity management, RSVP tracking, and automated reminder sequences ‚Äî functioning more like a mini event management system than a simple send.',
    origin: 'Event or appointment slot created in CRM or event management system. Eligible customer segment identified. Communications team approves the invitation for dispatch.',
    steps: [
      {
        phase: 'Audience Build',
        icon: '‚óà',
        color: '#b07ef5',
        title: 'Eligible segment identified and locked',
        desc: 'A SQL query in SFMC Automation Studio identifies eligible contacts based on journey stage, project affiliation, and past event attendance. The segment is reviewed and approved by the Communications team before any send. Contacts who attended the same event type in the last 90 days may be excluded to avoid fatigue.',
        tools: ['SFMC Automation Studio', 'SQL Query Activity', 'CRM Segment Builder'],
        sla: 'Segment built and approved 48 hours before first send',
        dependency: 'Attendance history tracked in CRM; segment criteria agreed with business stakeholder',
        owner: 'CX Manager + Communications Team'
      },
      {
        phase: 'Capacity Gate',
        icon: '‚¨°',
        color: '#f55a5a',
        title: 'Event capacity check before each wave',
        desc: 'If event has a venue capacity limit, SFMC checks current RSVP count before each invitation wave. Once capacity is 90% filled, remaining sends switch to a waitlist variant. This prevents overselling and maintains a quality experience. Capacity data is synced from the event management system in real time.',
        tools: ['Event management system API', 'SFMC Data Extension (RSVP_Count_DE)', 'Real-time capacity webhook'],
        sla: 'Capacity check runs within 5 min of each send batch',
        dependency: 'Event management system API integrated; RSVP_Count_DE updated in real time',
        owner: 'Events Team + SFMC Administrator'
      },
      {
        phase: 'Send ‚Äî Wave 1',
        icon: '‚Üí',
        color: '#22d3ee',
        title: 'Initial invitation dispatched',
        desc: 'Primary invitation email contains: event details, personalised RSVP link (tracked, unique per contact), location/agenda teaser, and RSVP deadline. WhatsApp sends the RSVP link with a short message. RSVP link opens a landing page that writes back Yes/No/Maybe to the CRM event record.',
        tools: ['SFMC Email Studio', 'WhatsApp Business API', 'RSVP landing page + CRM writeback'],
        sla: 'Send completes within 2 hours of segment approval',
        dependency: 'RSVP landing page live; CRM writeback tested; unique link generation active',
        owner: 'Communications Team'
      },
      {
        phase: 'RSVP Tracking',
        icon: '‚äû',
        color: '#3ecf7a',
        title: 'Response monitoring and non-responder path',
        desc: 'Contacts who click the RSVP link are tagged in CRM. Those who confirm Yes receive an auto-confirmation with calendar invite (.ics file). Those who do not respond within 5 days receive a second invitation wave. Those who decline are exited from the journey and excluded from further event reminders.',
        tools: ['SFMC Journey Decision Split', 'CRM RSVP status field', 'Calendar .ics generator'],
        sla: 'Second wave fires at Day +5 to non-responders',
        dependency: 'RSVP status synced to CRM within 30 min of link click',
        owner: 'Communications Team'
      },
      {
        phase: 'Pre-Event Reminder',
        icon: '‚è±',
        color: '#f5a623',
        title: 'T-24h and T-2h reminders for confirmed attendees',
        desc: 'Confirmed attendees receive an email reminder 24 hours before the event with full logistics (location, parking, agenda, dress code, contact number). A WhatsApp reminder fires 2 hours before with the venue address and a single CTA. No-shows are tagged in CRM after the event for follow-up.',
        tools: ['SFMC Automation Studio', 'SFMC MobileConnect', 'Event management system attendance log'],
        sla: 'T-24h email by 09:00 day before ¬∑ T-2h WA fires automatically',
        dependency: 'Event start time correctly stored in UTC; attendance sync post-event',
        owner: 'Events Team + Communications Team'
      }
    ],
    waitTimes: [{ label:'Segment build', time:'48h before first send' }, { label:'Wave 2 (non-responders)', time:'Day +5' }, { label:'T-24h reminder', time:'Day before event at 09:00' }, { label:'T-2h reminder', time:'2h before event start' }],
    escalation: 'If RSVP rate falls below 15% by Day +7, the Communications team reviews the invitation content and may approve a phone outreach wave to priority contacts.'
  },

  FU: {
    title: 'Follow Up',
    overview: 'Follow-ups exist to ensure no interaction falls through the cracks. They are triggered by a previous communication going unanswered, or a customer action that was expected but not completed. The process must be capped to avoid harassment.',
    origin: 'Previous send event logged in CRM with no response recorded after a defined wait window. The follow-up journey is a child journey spawned from the parent communication journey.',
    steps: [
      {
        phase: 'Wait & Check',
        icon: '‚è±',
        color: '#b07ef5',
        title: 'Wait window expires ‚Äî response check',
        desc: 'After the original communication is sent, a wait activity holds the contact in the follow-up journey for the configured period (24h, 48h, or 7 days depending on communication type). At the end of the wait, the system checks the CRM for any response, action completion, or direct contact from the customer.',
        tools: ['SFMC Journey Builder Wait Activity', 'CRM API real-time lookup', 'Activity log check'],
        sla: 'Check runs automatically at wait expiry ‚Äî no manual action needed',
        dependency: 'Response events write back to CRM within 30 min of occurrence',
        owner: 'SFMC Administrator'
      },
      {
        phase: 'Decision',
        icon: '‚¨°',
        color: '#f5a623',
        title: 'Response received or still outstanding?',
        desc: 'Decision split: if the customer has responded or completed the action, they exit the follow-up journey immediately and enter the appropriate next step. If not, they proceed to the follow-up send. The decision is based on a real-time CRM attribute check ‚Äî not a cached DE value.',
        tools: ['SFMC Decision Split', 'Salesforce SOQL real-time query', 'Journey exit trigger'],
        sla: 'Decision evaluated instantly at wait expiry',
        dependency: 'CRM sync latency under 15 min; response field correctly mapped',
        owner: 'SFMC Administrator'
      },
      {
        phase: 'Follow-up Send',
        icon: '‚Üí',
        color: '#22d3ee',
        title: 'Follow-up dispatched with alternative framing',
        desc: 'The follow-up message uses different copy from the original ‚Äî it acknowledges that the previous message may have been missed, offers an alternative contact route (WhatsApp, call-back request), and keeps the ask small. It references the specific original communication by date and subject to maintain context.',
        tools: ['SFMC Email Studio', 'WhatsApp Business API', 'Content Builder (follow-up variant template)'],
        sla: 'Send within 1h of decision split evaluation',
        dependency: 'Follow-up template approved; original send timestamp available for reference',
        owner: 'Communications Team'
      },
      {
        phase: 'Fatigue Cap',
        icon: '‚úì',
        color: '#3ecf7a',
        title: 'Maximum follow-up cap enforced',
        desc: 'The system enforces a hard cap of 3 follow-ups per 30-day window per contact, across all communication types. A Contact Frequency DE is updated after each follow-up send. If a contact has already received 3 follow-ups this month, they are exited from the journey and a CRM task is raised for manual outreach.',
        tools: ['SFMC Contact Frequency DE', 'Journey exit trigger', 'CRM task creation'],
        sla: 'Frequency cap checked before every follow-up send',
        dependency: 'Frequency DE updated within 30 min of every follow-up send',
        owner: 'CX Manager + SFMC Administrator'
      },
      {
        phase: 'Manual Handoff',
        icon: '‚äû',
        color: '#f55a5a',
        title: 'Final follow-up triggers relationship manager task',
        desc: 'After the final automated follow-up, a CRM task is created for the assigned relationship manager: contact the customer by phone. The task includes a summary of all previous touch attempts, dates, and channels used. If no contact is made within 3 business days, the case escalates to department head.',
        tools: ['Salesforce CRM Task', 'CRM communication history log', 'Slack escalation notification'],
        sla: 'Task created within 30 min of final follow-up send; completed within 3 business days',
        dependency: 'Relationship manager field populated on every customer record',
        owner: 'Relationship Manager + Department Head'
      }
    ],
    waitTimes: [{ label:'Initial wait window', time:'24h / 48h / 7 days (configured per comm type)' }, { label:'Between follow-up sends', time:'Minimum 48h' }, { label:'Manual task SLA', time:'3 business days' }],
    escalation: 'If a customer has been unreachable for 14 days across all channels, the case is escalated to senior management and flagged as "at-risk contact" in the CX dashboard.'
  },

  UP: {
    title: 'Update',
    overview: 'Updates are periodic, often batch-sent communications that keep the customer informed about the state of something ongoing ‚Äî construction progress, community news, service changes. They are scheduled, content-driven, and managed through a content calendar.',
    origin: 'Content calendar event triggers the update workflow. Content is prepared by the Communications or Development team, reviewed, approved, and loaded into SFMC for scheduled dispatch.',
    steps: [
      {
        phase: 'Content Preparation',
        icon: '‚óà',
        color: '#b07ef5',
        title: 'Update content created and reviewed',
        desc: 'The responsible team (Development for construction, Community Management for resident updates, Marketing for campaigns) prepares the update content. Content goes through a standard review: (1) Factual accuracy check, (2) Legal/compliance review if needed, (3) Brand and tone review by Communications team, (4) Final sign-off by Department Head.',
        tools: ['Content management system', 'Microsoft Teams / document review workflow', 'SFMC Content Builder'],
        sla: 'Content submitted 5 business days before scheduled send; approved 2 days before',
        dependency: 'Review stakeholders available and assigned; content calendar agreed',
        owner: 'Communications Team + Department Lead'
      },
      {
        phase: 'Audience Segmentation',
        icon: '‚äû',
        color: '#3ecf7a',
        title: 'Audience filtered by project, stage, and preference',
        desc: 'SFMC query segments the audience by: project affiliation (which development), current journey stage (buyer/resident/ex-resident), communication preferences (email only, WhatsApp preferred), and language preference (EN/AR). Contacts who have opted out of marketing updates are excluded. The final segment count is shared with the approver before send.',
        tools: ['SFMC Automation Studio', 'SQL Segment Query', 'CRM preference centre data'],
        sla: 'Segment built and approved 24 hours before send',
        dependency: 'Preference data accurate in CRM; project affiliation field populated',
        owner: 'SFMC Administrator + CX Manager'
      },
      {
        phase: 'Pre-send QA',
        icon: '‚úì',
        color: '#22d3ee',
        title: 'Test send and rendering check',
        desc: 'A test send goes to a QA distribution list covering: Desktop email clients (Outlook, Gmail), Mobile email (iOS Mail, Gmail Mobile), and WhatsApp preview. Rendering is checked on both EN and AR versions. Any broken links, missing images, or rendering issues must be resolved before proceeding.',
        tools: ['SFMC Test Send', 'Litmus or Email on Acid (rendering)', 'QA distribution list'],
        sla: 'QA completed and signed off 4 hours before scheduled send',
        dependency: 'QA list maintained; rendering tool subscription active',
        owner: 'Communications Team'
      },
      {
        phase: 'Scheduled Send',
        icon: '‚Üí',
        color: '#f5a623',
        title: 'Batch send at approved time window',
        desc: 'Update emails are scheduled to send in the 09:00‚Äì11:00 window (local time) to maximise open rates. WhatsApp messages send in the same window. Large batches (over 50k contacts) are split into hourly waves to manage server load and bounce rate monitoring. Send time is never on weekends or public holidays.',
        tools: ['SFMC Scheduled Send', 'SFMC MobileConnect Batch', 'Send throttle configuration'],
        sla: 'All sends complete within the 09:00‚Äì13:00 window on send day',
        dependency: 'Scheduled send configured minimum 2 hours before; holiday calendar configured',
        owner: 'SFMC Administrator + Communications Team'
      },
      {
        phase: 'Performance Review',
        icon: '‚äû',
        color: '#b07ef5',
        title: 'Engagement reported and acted on',
        desc: 'At T+24h and T+72h, Analytics Builder reports are pulled: open rate, click rate, bounce rate, opt-out rate, WhatsApp read rate. Results are shared with the Department Head. If opt-out rate exceeds 0.3% or bounce rate exceeds 2%, a content review is triggered before the next update in the same series.',
        tools: ['SFMC Analytics Builder', 'Scheduled report distribution', 'Bounce management workflow'],
        sla: 'T+24h report delivered by 10:00 next business day',
        dependency: 'Analytics Builder reports pre-configured; stakeholder distribution list set up',
        owner: 'CX Manager'
      }
    ],
    waitTimes: [{ label:'Content submission deadline', time:'5 business days before send' }, { label:'QA window', time:'4h before send' }, { label:'Performance report T+24h', time:'Next business day 10:00' }],
    escalation: 'Opt-out rate >0.5% triggers an immediate pause of the update series pending a content and frequency review by the CX Manager and Department Head.'
  },

  VOC: {
    title: 'Voice of Customer',
    overview: 'VOC communications are not just sends ‚Äî they are the beginning of a feedback loop that must close. Every survey must be followed by action, and every low score must trigger a recovery process. Without a closed loop, VOC becomes data theater.',
    origin: 'Key customer milestone completed (SPA collected, handover done, move-in completed, service request closed). The milestone triggers the VOC journey.',
    steps: [
      {
        phase: 'Trigger',
        icon: '‚ö°',
        color: '#14b8a6',
        title: 'Milestone event fires survey trigger',
        desc: 'A completed milestone in CRM (HO_Status = Completed, SR_Status = Closed, SPA_Collected = True) fires the VOC journey. A built-in wait activity introduces a delay appropriate to the milestone (0 for immediate post-interaction like SR closing; 2 hours for handover to give the customer time to settle). This prevents the survey feeling rushed.',
        tools: ['Salesforce CRM event', 'SFMC Triggered Journey', 'Data Extension: VOC_Queue_DE'],
        sla: 'Survey fires within 2h of milestone (post-wait delay); max 24h after event',
        dependency: 'CRM milestone fields correctly mapped; duplicate survey suppression active',
        owner: 'CRM Administrator'
      },
      {
        phase: 'Suppression',
        icon: '‚úì',
        color: '#3ecf7a',
        title: 'Survey fatigue and duplicate check',
        desc: 'Before sending, the system checks: (a) Has this customer already received a survey for this specific milestone? (b) Have they received any survey in the last 14 days? (c) Are they currently in a complaints or escalation journey? Customers meeting any of these conditions are suppressed. This protects both the customer experience and the data quality.',
        tools: ['SFMC Suppression DE (VOC_Sent_DE)', 'Journey conflict check', 'CRM complaint flag'],
        sla: 'Check runs within 60 seconds of trigger',
        dependency: 'VOC_Sent_DE updated after every survey send; complaint flag synced from CRM',
        owner: 'SFMC Administrator + CX Manager'
      },
      {
        phase: 'Survey Send',
        icon: '‚Üí',
        color: '#14b8a6',
        title: 'Survey dispatched ‚Äî Day 0, +3, +7',
        desc: 'Day 0: email with survey link (personalised, pre-authenticated) + WhatsApp with short-form link. If no response by Day +3: second send, different subject line, shorter body. If still no response by Day +7: final send, WhatsApp only, very brief. All three sends use the same unique survey link ‚Äî responses at any point update the same record.',
        tools: ['Survey platform (SurveyMonkey / Qualtrics / custom)', 'SFMC Email + WA', 'Unique link per contact with CRM param'],
        sla: 'Day 0 within 2h of trigger ¬∑ Day +3 and +7 automated',
        dependency: 'Survey platform integrated with CRM; unique link generation live',
        owner: 'Communications Team + CX Manager'
      },
      {
        phase: 'Response Routing',
        icon: '‚¨°',
        color: '#f5a623',
        title: 'Score received ‚Äî routed by NPS band',
        desc: 'When a response is submitted, the score is written to CRM within 5 minutes. An SFMC automation reads the score and routes the contact: Detractors (1-6) ‚Üí Recovery Journey (immediate CX manager notification, call within 24h). Passives (7-8) ‚Üí Nurture Journey (newsletter, next event invite). Promoters (9-10) ‚Üí Referral Journey (testimonial request, referral incentive offer).',
        tools: ['Survey platform webhook ‚Üí CRM', 'SFMC Automation Score Routing', 'CX Manager Slack alert'],
        sla: 'Score in CRM within 5 min of submission; CX alert within 10 min for Detractors',
        dependency: 'Survey webhook tested; NPS routing thresholds configured in journey',
        owner: 'CX Manager'
      },
      {
        phase: 'Recovery (Detractors)',
        icon: '‚¨°',
        color: '#f55a5a',
        title: 'Detractor recovery ‚Äî 24-hour call SLA',
        desc: 'For every Detractor score, a CRM task is created and assigned to the customer\'s relationship manager: "Detractor recovery call ‚Äî call within 24h." The CX Manager receives a real-time Slack notification with the customer name, score, and verbatim feedback. The call outcome is logged in CRM and the case is not closed until the CX Manager marks it resolved.',
        tools: ['Salesforce CRM Task', 'Slack webhook (real-time alert)', 'CRM complaint resolution workflow'],
        sla: 'Call attempted within 24h ¬∑ Case resolved within 5 business days',
        dependency: 'Relationship manager assigned; Slack integration live; CRM task template configured',
        owner: 'Relationship Manager + CX Manager'
      },
      {
        phase: 'Closed Loop',
        icon: '‚äû',
        color: '#b07ef5',
        title: 'Insights reported and acted on',
        desc: 'Weekly VOC digest report is auto-generated in Analytics Builder and distributed to all Department Heads. Monthly, the CX team presents trend analysis showing NPS movement, top verbatim themes, and action items per department. Departments are accountable for owning the actions from their own scores. Changes made as a result of VOC feedback are communicated back to customers where relevant.',
        tools: ['SFMC Analytics Builder', 'Text analytics (Qualtrics / manual tagging)', 'CX dashboard', 'PowerPoint / reporting tool'],
        sla: 'Weekly digest every Monday 09:00 ¬∑ Monthly review first Tuesday of month',
        dependency: 'Analytics Builder reports configured; distribution list includes all HODs',
        owner: 'CX Manager + All Department Heads'
      }
    ],
    waitTimes: [{ label:'Milestone ‚Üí Survey Day 0', time:'0‚Äì2h depending on type' }, { label:'Day +3 send', time:'If no response' }, { label:'Day +7 final', time:'If still no response' }, { label:'Score ‚Üí CRM', time:'< 5 min' }, { label:'Detractor call SLA', time:'24h' }],
    escalation: 'If NPS drops below the defined threshold for 2 consecutive weeks, an emergency CX review is convened with the CEO and all HODs within 5 business days.'
  }
};


// ‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê
let activeStage = 'all', activeDepts = new Set(), activeTypes = new Set(), activeChannels = new Set(), searchQ = '';

// ‚ïê‚ïê‚ïê FILTER ‚ïê‚ïê‚ïê
function filtered() {
  return COMMS.filter(c => {
    if (activeStage !== 'all' && c.stage !== activeStage) return false;
    if (activeDepts.size && !activeDepts.has(c.dept)) return false;
    if (activeTypes.size && !activeTypes.has(c.type)) return false;
    if (activeChannels.size && !c.channels.some(ch => activeChannels.has(ch))) return false;
    if (searchQ && !c.desc.toLowerCase().includes(searchQ) && !c.dept.toLowerCase().includes(searchQ)) return false;
    return true;
  });
}

// ‚ïê‚ïê‚ïê RENDER SIDEBAR ‚ïê‚ïê‚ïê
function renderSidebar() {
  // Stages
  document.getElementById('sNav').innerHTML = STAGES.map(s => {
    const cnt = s.id==='all' ? COMMS.length : COMMS.filter(c=>c.stage===s.id).length;
    return `<button class="stage-btn${activeStage===s.id?' on':''}" onclick="setStage('${s.id}')">
      <span class="s-dot" style="background:${s.color}"></span>${s.label}<span class="s-cnt">${cnt}</span>
    </button>`;
  }).join('');

  // Channels
  document.getElementById('chFilters').innerHTML = CHANNELS.map(ch => {
    const icons = {'E-mail':'‚úâÔ∏è','SMS':'üí¨','WhatsApp':'üíö','Portal':'üîµ','Call':'üìû','Courier':'üì¶','Website':'üåê','Social Media':'üì£'};
    return `<button class="cchip${activeChannels.has(ch)?' on':''}" onclick="toggleChannel('${ch}')">
      <span class="cicon">${icons[ch]||'üì°'}</span>${ch}
    </button>`;
  }).join('');

  // Depts
  const depts = [...new Set(COMMS.map(c=>c.dept))].sort();
  document.getElementById('dpFilters').innerHTML = depts.map(d =>
    `<button class="chip${activeDepts.has(d)?' on':''}" onclick="toggleDept('${d}')">${d}</button>`
  ).join('');

  // Types
  document.getElementById('tpFilters').innerHTML = Object.entries(TYPES).map(([k,v]) =>
    `<button class="tchip${activeTypes.has(k)?' on':''}" onclick="toggleType('${k}')">
      <span class="td" style="background:${v.color}"></span>${k}
    </button>`
  ).join('');
}

// ‚ïê‚ïê‚ïê RENDER CARDS ‚ïê‚ïê‚ïê
function render() {
  searchQ = document.getElementById('srch').value.toLowerCase();
  const f = filtered();
  const stg = STAGES.find(s=>s.id===activeStage);
  document.getElementById('stTitle').textContent = stg.label;
  document.getElementById('stSub').textContent = stg.sub;
  document.getElementById('cnt').textContent = `${f.length} communication${f.length!==1?'s':''}`;
  renderSidebar();

  if (!f.length) {
    document.getElementById('grid').innerHTML = `<div class="empty">No communications match your current filters.</div>`;
    return;
  }

  const stageColor = s => STAGES.find(x=>x.id===s)?.color||'#7b7ff5';
  document.getElementById('grid').innerHTML = f.map(c => {
    const t = TYPES[c.type]; const sc = stageColor(c.stage);
    return `
    <div class="card" style="--cc:${sc}">
      <style>#c${c.id}::after{background:linear-gradient(90deg,${t.color},${sc})}</style>
      <div id="c${c.id}" class="card" style="padding:0;background:transparent;border:none;position:absolute;inset:0;border-radius:inherit;pointer-events:none"></div>
      <div class="card-top">
        <span class="tbadge" style="background:${t.color}1a;color:${t.color};border:1px solid ${t.color}35">${c.type}</span>
        <div class="cdesc">${c.desc}</div>
      </div>
      <div class="meta-row">
        ${c.channels.map(ch=>`<span class="mpill ch">${ch}</span>`).join('')}
        <span class="mpill dp">${c.dept}</span>
        <span class="mpill tm">${c.timing}</span>
      </div>
      <div class="trigger-line">‚ßñ ${c.trigger}</div>
      <div class="card-actions">
        <button class="ca-btn sfmc" onclick="openSFMC(${c.id})">
          ‚öô SFMC Process Map
        </button>
        <button class="ca-btn content" onclick="openContent(${c.id})">
          ‚úé EN / AR Content
        </button>
      </div>
    </div>`;
  }).join('');
}

function setStage(id) { activeStage=id; render(); }
function toggleDept(d) { activeDepts.has(d)?activeDepts.delete(d):activeDepts.add(d); render(); }
function toggleType(t) { activeTypes.has(t)?activeTypes.delete(t):activeTypes.add(t); render(); }
function toggleChannel(ch) { activeChannels.has(ch)?activeChannels.delete(ch):activeChannels.add(ch); render(); }

// ‚ïê‚ïê‚ïê PROCESS MAP MODAL ‚ïê‚ïê‚ïê
function openSFMC(id) {
  const c = COMMS.find(x=>x.id===id);
  const t = TYPES[c.type];
  const pm = PROCESS_MAPS[c.type];
  const stg = STAGES.find(s=>s.id===c.stage);
  if (!pm) return;

  document.getElementById('sfmcTitle').innerHTML =
    `<span style="color:${stg?.color};font-size:11px;font-weight:500;display:block;margin-bottom:3px">${stg?.label} ¬∑ <span style="color:${t.color}">${c.type} ‚Äî ${pm.title}</span></span>${c.desc}`;
  document.getElementById('sfmcSub').textContent =
    `${c.dept} ¬∑ ${c.channels.join(', ')} ¬∑ ${c.timing} ¬∑ Trigger: ${c.trigger}`;

  const stepsHTML = pm.steps.map((s, i) => `
    <div class="pm-step" style="--step-color:${s.color}">
      <div class="pm-step-left">
        <div class="pm-step-icon" style="background:${s.color}15;border-color:${s.color}40;color:${s.color}">${s.icon}</div>
        <div class="pm-phase-lbl" style="color:${s.color}">${s.phase}</div>
      </div>
      <div class="pm-step-body">
        <div class="pm-step-title" style="color:${s.color}">${i+1}. ${s.title}</div>
        <div class="pm-step-desc">${s.desc}</div>
        <div class="pm-meta-row">
          <span class="pm-meta-label">Tools</span>
          <div class="pm-tools">${s.tools.map(t=>`<span class="pm-tool">${t}</span>`).join('')}</div>
        </div>
        <div class="pm-meta-row" style="margin-top:6px">
          <span class="pm-meta-label">SLA</span>
          <span class="pm-sla">${s.sla}</span>
        </div>
        <div class="pm-meta-row" style="margin-top:5px">
          <span class="pm-meta-label">Depends on</span>
          <span class="pm-dep">${s.dependency}</span>
        </div>
        <div class="pm-meta-row" style="margin-top:5px">
          <span class="pm-meta-label">Owner</span>
          <span class="pm-owner-tag">${s.owner}</span>
        </div>
      </div>
    </div>`).join('');

  const slasHTML = pm.waitTimes.map(w=>`
    <div class="pm-sla-row">
      <span>${w.label}</span>
      <span>${w.time}</span>
    </div>`).join('');

  document.getElementById('sfmcBody').innerHTML = `
    <p class="pm-overview">${pm.overview}</p>
    <div class="pm-origin"><strong>Origin:</strong> ${pm.origin}</div>
    <div class="pm-steps">${stepsHTML}</div>
    <div class="pm-slas-block">
      <div class="pm-slas-title">SLA Reference ‚Äî ${pm.title}</div>
      ${slasHTML}
      <div class="pm-escalation">
        <div class="pm-esc-lbl">Escalation Path</div>
        <div class="pm-esc-text">${pm.escalation}</div>
      </div>
    </div>`;

  document.getElementById('sfmcModal').classList.add('open');
}

// ‚ïê‚ïê‚ïê CONTENT MODAL ‚ïê‚ïê‚ïê
function openContent(id) {
  const c = COMMS.find(x=>x.id===id);
  const t = TYPES[c.type];
  const sc = STAGES.find(s=>s.id===c.stage)?.color||'#7b7ff5';
  document.getElementById('cTitle').textContent = `Content Template`;
  document.getElementById('cSub').textContent = c.desc;
  document.getElementById('cGoal').innerHTML = `<span class="goal-pill" style="background:${t.color}1a;border:1px solid ${t.color}35;color:${t.color}">Goal: ${c.goal}</span>`;
  document.getElementById('cChannels').innerHTML = `<div class="channel-row">${c.channels.map(ch=>`<span class="ch-used" style="background:${sc}1a;border:1px solid ${sc}35;color:${sc}">${ch}</span>`).join('')}</div>`;
  // Clear textareas
  document.querySelectorAll('#contentModal textarea').forEach(t=>t.value='');
  setLang('en');
  document.getElementById('contentModal').classList.add('open');
}

function setLang(lang) {
  document.querySelectorAll('.lang-tab').forEach(t=>t.classList.remove('on'));
  document.querySelectorAll('.content-block').forEach(b=>b.classList.remove('show'));
  document.querySelector(`.lang-tab:${lang==='en'?'first':'last'}-child`).classList.add('on');
  document.getElementById(lang+'Block').classList.add('show');
}

function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-bg').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('open');}));

// ‚ïê‚ïê‚ïê RADIAL MAP ‚ïê‚ïê‚ïê
// Zoom/pan state
let rZoom = 1, rPanX = 0, rPanY = 0, rDragging = false, rDragStart = null;

function applyRadialTransform() {
  const g = document.getElementById('rsvgG');
  if (g) g.setAttribute('transform', `translate(${rPanX},${rPanY}) scale(${rZoom})`);
  const lbl = document.getElementById('zoomLbl');
  if (lbl) lbl.textContent = Math.round(rZoom * 100) + '%';
}

function zoomBy(factor) {
  rZoom = Math.max(0.3, Math.min(5, rZoom * factor));
  applyRadialTransform();
}

function zoomReset() {
  rZoom = 1; rPanX = 0; rPanY = 0;
  applyRadialTransform();
}

function initRadialPan() {
  const svg = document.getElementById('rsvg');
  if (!svg || svg._panInit) return;
  svg._panInit = true;

  svg.addEventListener('wheel', e => {
    e.preventDefault();
    const factor = e.deltaY < 0 ? 1.1 : 0.91;
    zoomBy(factor);
  }, { passive: false });

  svg.addEventListener('mousedown', e => {
    rDragging = true;
    rDragStart = { x: e.clientX - rPanX, y: e.clientY - rPanY };
    svg.classList.add('dragging');
  });
  window.addEventListener('mousemove', e => {
    if (!rDragging) return;
    rPanX = e.clientX - rDragStart.x;
    rPanY = e.clientY - rDragStart.y;
    applyRadialTransform();
  });
  window.addEventListener('mouseup', () => {
    rDragging = false;
    document.getElementById('rsvg')?.classList.remove('dragging');
  });

  // Touch support
  let lastTouchDist = null;
  svg.addEventListener('touchstart', e => {
    if (e.touches.length === 1) {
      rDragging = true;
      rDragStart = { x: e.touches[0].clientX - rPanX, y: e.touches[0].clientY - rPanY };
    } else if (e.touches.length === 2) {
      lastTouchDist = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
    }
  }, { passive: true });
  svg.addEventListener('touchmove', e => {
    e.preventDefault();
    if (e.touches.length === 1 && rDragging) {
      rPanX = e.touches[0].clientX - rDragStart.x;
      rPanY = e.touches[0].clientY - rDragStart.y;
      applyRadialTransform();
    } else if (e.touches.length === 2 && lastTouchDist) {
      const d = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
      zoomBy(d / lastTouchDist);
      lastTouchDist = d;
    }
  }, { passive: false });
  svg.addEventListener('touchend', () => { rDragging = false; lastTouchDist = null; });
}

function buildRadial() {
  const g = document.getElementById('rsvgG');
  const cx=340, cy=340, outerR=308, gap=0.018;
  const stgs = STAGES.filter(s=>s.id!=='all');
  const total = COMMS.length;
  let out = '';

  [70, 130, 190, 250, outerR].forEach(r=>{
    out+=`<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="rgba(255,255,255,0.032)" stroke-width="0.7" stroke-dasharray="3 6"/>`;
  });

  let startAng = -Math.PI/2;

  stgs.forEach((stage) => {
    const sc = COMMS.filter(c=>c.stage===stage.id);
    const stageAng = (sc.length/total)*2*Math.PI - gap*2;
    const endAng = startAng + stageAng;
    const midAng = startAng + stageAng/2;

    const lg = stageAng > Math.PI ? 1 : 0;
    const sX1 = cx + 8*Math.cos(startAng+gap),  sY1 = cy + 8*Math.sin(startAng+gap);
    const sX2 = cx + outerR*Math.cos(startAng+gap), sY2 = cy + outerR*Math.sin(startAng+gap);
    const eX2 = cx + outerR*Math.cos(endAng),   eY2 = cy + outerR*Math.sin(endAng);
    const eX1 = cx + 8*Math.cos(endAng),        eY1 = cy + 8*Math.sin(endAng);
    out+=`<path d="M${sX1},${sY1} L${sX2},${sY2} A${outerR},${outerR} 0 ${lg} 1 ${eX2},${eY2} L${eX1},${eY1} A8,8 0 ${lg} 0 ${sX1},${sY1} Z" fill="${stage.color}07" stroke="none"/>`;

    const dX = cx+(outerR+48)*Math.cos(startAng); const dY = cy+(outerR+48)*Math.sin(startAng);
    out+=`<line x1="${cx}" y1="${cy}" x2="${dX}" y2="${dY}" stroke="${stage.color}" stroke-width="0.8" opacity="0.4"/>`;

    const labelR = outerR + 22;
    const lx = cx+labelR*Math.cos(midAng), ly = cy+labelR*Math.sin(midAng);
    const ldeg = midAng*180/Math.PI;
    const lflip = ldeg > 90 && ldeg < 270;
    out+=`<text transform="translate(${lx},${ly}) rotate(${lflip ? ldeg+180 : ldeg})"
      text-anchor="${lflip?'end':'start'}" dominant-baseline="middle"
      fill="${stage.color}" font-size="9.5" font-family="Space Mono"
      letter-spacing="1.8" font-weight="700">${stage.label.toUpperCase()}</text>`;

    sc.forEach((comm, i) => {
      const frac = (i + 0.5) / sc.length;
      const ang = startAng + gap + frac * stageAng;
      const minR = 18, maxR = outerR - 6;
      const spokeLen = minR + (i / Math.max(sc.length - 1, 1)) * (maxR - minR);
      const ex = cx + spokeLen * Math.cos(ang), ey = cy + spokeLen * Math.sin(ang);
      const dx = cx + (spokeLen + 5) * Math.cos(ang), dy = cy + (spokeLen + 5) * Math.sin(ang);

      out += `<g class="sp" data-id="${comm.id}" style="cursor:pointer">
        <line x1="${cx}" y1="${cy}" x2="${ex}" y2="${ey}" stroke="${stage.color}" stroke-width="0.7" opacity="0.45" class="sl"/>
        <circle cx="${dx}" cy="${dy}" r="2.4" fill="${stage.color}" opacity="0.85" class="sd"/>`;

      const textR = spokeLen + 13;
      const tx = cx + textR*Math.cos(ang), ty2 = cy + textR*Math.sin(ang);
      const deg = ang * 180 / Math.PI;
      const flip = deg > 90 && deg < 270;
      const shortDesc = comm.desc.length > 40 ? comm.desc.substring(0,40)+'‚Ä¶' : comm.desc;
      out += `<text transform="translate(${tx},${ty2}) rotate(${flip ? deg+180 : deg})"
        text-anchor="${flip?'end':'start'}" dominant-baseline="middle"
        fill="${stage.color}" font-size="6.2" font-family="Sora" opacity="0.75" class="stxt">${comm.type} ¬∑ ${shortDesc}</text>`;
      out += `</g>`;
    });

    startAng = endAng + gap * 2;
  });

  out += `<circle cx="${cx}" cy="${cy}" r="3.5" fill="rgba(255,255,255,0.2)"/>`;
  out += `<circle cx="${cx}" cy="${cy}" r="1.8" fill="rgba(255,255,255,0.5)"/>`;

  g.innerHTML = out;

  document.getElementById('rLegend').innerHTML = stgs.map(s=>{
    const cnt = COMMS.filter(c=>c.stage===s.id).length;
    return `<div class="legend-item">
      <span class="ld" style="background:${s.color}"></span>
      <span>${s.label}</span>
      <span class="lcount">${cnt}</span>
    </div>`;
  }).join('');

  document.getElementById('rAbbrev').innerHTML = Object.entries(TYPES).map(([k,v])=>
    `<div class="ab"><strong>${k}</strong> ${v.label}</div>`
  ).join('');

  const tt = document.getElementById('tt');
  g.querySelectorAll('.sp').forEach(el=>{
    el.addEventListener('mouseenter', e=>{
      const c = COMMS.find(x=>x.id===+el.dataset.id);
      const t2 = TYPES[c.type];
      const stg = STAGES.find(s=>s.id===c.stage);
      tt.innerHTML = `
        <div class="tt-type" style="color:${stg?.color}">${stg?.label}</div>
        <div style="color:${t2.color};font-size:10px;margin-bottom:5px">${c.type} ‚Äî ${t2.label}</div>
        <div>${c.desc}</div>
        <div class="tt-meta">üìã ${c.dept} ¬∑ ${c.channels.join(', ')}</div>
        <div class="tt-meta">‚ßñ ${c.trigger} ¬∑ ${c.timing}</div>`;
      tt.classList.add('show');
      el.querySelector('.sl').setAttribute('stroke-width','2');
      el.querySelector('.sl').setAttribute('opacity','1');
      el.querySelector('.sd').setAttribute('r','4');
    });
    el.addEventListener('mousemove',e=>{
      tt.style.left=(e.clientX+14)+'px';
      tt.style.top=(e.clientY-50)+'px';
    });
    el.addEventListener('mouseleave',()=>{
      tt.classList.remove('show');
      el.querySelector('.sl').setAttribute('stroke-width','0.7');
      el.querySelector('.sl').setAttribute('opacity','0.45');
      el.querySelector('.sd').setAttribute('r','2.4');
    });
  });

  initRadialPan();
}

// ‚ïê‚ïê‚ïê LIST VIEW ‚ïê‚ïê‚ïê
function buildList() {
  const stgs = STAGES.filter(s=>s.id!=='all');
  const chColors = {
    'E-mail':'#5b9ef7','SMS':'#f5a623','WhatsApp':'#25d366',
    'Portal':'#7b7ff5','Call':'#f55a5a','Courier':'#e879a0',
    'Website':'#22d3ee','Social Media':'#f5c842'
  };
  const chIcons = {
    'E-mail':'‚úâ','SMS':'üí¨','WhatsApp':'‚úÜ','Portal':'‚¨°',
    'Call':'‚òé','Courier':'‚¨°','Website':'‚äï','Social Media':'‚äû'
  };

  let globalNum = 1;
  let html = `
    <div style="margin-bottom:28px;padding-bottom:20px;border-bottom:1px solid var(--border)">
      <h2 style="font-size:22px;font-weight:700;margin-bottom:6px">Communications Register</h2>
      <p style="font-size:12px;color:var(--text3)">${COMMS.length} communications across ${stgs.length} journey stages ‚Äî click any row to open content template</p>
    </div>
    <div class="lv-thead">
      <div class="lv-th center">#</div>
      <div class="lv-th center">Type</div>
      <div class="lv-th">Communication</div>
      <div class="lv-th">Dept</div>
      <div class="lv-th">Timing</div>
      <div class="lv-th">Channels</div>
    </div>`;

  stgs.forEach(stage => {
    const sc = COMMS.filter(c=>c.stage===stage.id);
    html += `<div class="lv-stage-block">
      <div class="lv-stage-hdr" style="background:${stage.color}0e;border-left:3px solid ${stage.color}">
        <div>
          <div class="lv-stage-name" style="color:${stage.color}">${stage.label}</div>
          <div class="lv-stage-sub" style="color:${stage.color};opacity:0.6">${stage.sub}</div>
        </div>
        <span class="lv-stage-cnt" style="background:${stage.color}22;color:${stage.color}">${sc.length} comms</span>
      </div>`;

    sc.forEach(c => {
      const t = TYPES[c.type];
      const n = globalNum++;
      html += `
      <div class="lv-row" onclick="openContent(${c.id})" title="Click to open content template">
        <div class="lv-col num" style="color:${stage.color};opacity:0.5">${n}</div>
        <div class="lv-col type">
          <span class="lv-type-badge" style="background:${t.color}18;color:${t.color};border:1px solid ${t.color}30">${c.type}</span>
        </div>
        <div class="lv-col desc">
          <div>
            <div style="font-weight:500;line-height:1.4;margin-bottom:3px">${c.desc}</div>
            <div style="font-size:10px;color:var(--text3);font-family:'Space Mono',monospace">‚ßñ ${c.trigger}</div>
          </div>
        </div>
        <div class="lv-col dept" style="font-size:11px;color:var(--text2)">${c.dept}</div>
        <div class="lv-col timing" style="font-size:10px;color:var(--text2)">${c.timing}</div>
        <div class="lv-col chs">
          ${c.channels.map(ch=>`<span title="${ch}" style="display:inline-flex;align-items:center;justify-content:center;width:20px;height:20px;border-radius:50%;background:${chColors[ch]||'var(--text3)'}18;border:1px solid ${chColors[ch]||'var(--text3)'}35;font-size:9px;color:${chColors[ch]||'var(--text2)'};">${chIcons[ch]||'¬∑'}</span>`).join('')}
        </div>
      </div>`;
    });

    html += `</div>`;
  });

  document.getElementById('lvInner').innerHTML = html;
}

// ‚ïê‚ïê‚ïê THEME ‚ïê‚ïê‚ïê
function toggleTheme() {
  const isLight = document.documentElement.classList.toggle('light');
  document.getElementById('themeLbl').textContent = isLight ? 'Light' : 'Dark';
  localStorage.setItem('rnsc-theme', isLight ? 'light' : 'dark');
  // Rebuild radial with correct ring colour if already built
  if (radialBuilt) {
    const g = document.getElementById('rsvgG');
    g.querySelectorAll('circle[stroke]').forEach(c => {
      if (c.getAttribute('fill') === 'none') {
        c.setAttribute('stroke', isLight ? 'rgba(80,90,160,0.08)' : 'rgba(255,255,255,0.032)');
      }
    });
  }
}

// Detect saved preference or system preference
(function initTheme() {
  const saved = localStorage.getItem('rnsc-theme');
  const preferLight = saved ? saved === 'light' : window.matchMedia('(prefers-color-scheme: light)').matches;
  if (preferLight) {
    document.documentElement.classList.add('light');
    document.addEventListener('DOMContentLoaded', () => {
      const lbl = document.getElementById('themeLbl');
      if (lbl) lbl.textContent = 'Light';
    });
  }
})();

// ‚ïê‚ïê‚ïê VIEW SWITCH ‚ïê‚ïê‚ïê
let radialBuilt = false, listBuilt = false;
function setView(v) {
  ['tv','rv','lv'].forEach(id=>{
    document.getElementById(id).style.display = 'none';
    document.getElementById('btn-'+id).classList.remove('active');
  });
  const display = v==='tv' ? 'flex' : v==='rv' ? 'flex' : 'block';
  document.getElementById(v).style.display = display;
  document.getElementById('btn-'+v).classList.add('active');
  if (v==='rv' && !radialBuilt) { buildRadial(); radialBuilt=true; }
  if (v==='lv' && !listBuilt) { buildList(); listBuilt=true; }
}

// ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê
render();
</script>
</body>
</html>
